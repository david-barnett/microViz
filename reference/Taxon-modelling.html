<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Statistical modelling for individual taxa in a phyloseq — Taxon-modelling • microViz</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Statistical modelling for individual taxa in a phyloseq — Taxon-modelling" />
<meta property="og:description" content="tax_model provides a simple framework to statistically model the abundance of individual taxa in your data.
You can choose which type of statistical model you want to fit, and you can choose at which rank and (optionally) which specific taxa to fit statistical models for.
tax_model takes a phyloseq and returns a list of statistical models, one model for each taxon.
The same independent variables are used for all models, as specified in variables or formula argument (latter takes precedence).
taxatree_models runs tax_model on every taxon at multiple taxonomic ranks (you choose which ranks with the plural tax_levels argument),
and returns the results as a named nested list designed for use with taxatree_plots.
One list per rank, one model per taxon at each rank.
type = &quot;bbdml&quot; will run beta binomial regression model(s) using the corncob package.
For bbdml the same formula/variables is/are used for modelling both the abundance and dispersion parameters." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">microViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.6.1.9003</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/articles/microViz.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/Interactive-Ordination.html">Interactive Ordination Plot</a>
    </li>
    <li>
      <a href="../articles/articles/Visualising-compositions.html">Visualising compositions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/david-barnett/microViz/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Statistical modelling for individual taxa in a phyloseq</h1>
    <small class="dont-index">Source: <a href='https://github.com/david-barnett/microViz/blob/master/R/tax_model.R'><code>R/tax_model.R</code></a></small>
    <div class="hidden name"><code>Taxon-modelling.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>tax_model</code> provides a simple framework to statistically model the abundance of individual taxa in your data.
You can choose which type of statistical model you want to fit, and you can choose at which rank and (optionally) which specific taxa to fit statistical models for.
<code>tax_model</code> takes a phyloseq and returns a list of statistical models, one model for each taxon.
The same independent variables are used for all models, as specified in <code>variables</code> or <code>formula</code> argument (latter takes precedence).</p>
<p><code>taxatree_models</code> runs <code>tax_model</code> on every taxon at multiple taxonomic ranks (you choose which ranks with the plural <code>tax_levels</code> argument),
and returns the results as a named nested list designed for use with <code>taxatree_plots</code>.
One list per rank, one model per taxon at each rank.</p>
<p><code>type = "bbdml"</code> will run beta binomial regression model(s) using the <code>corncob</code> package.
For bbdml the same formula/variables is/are used for modelling both the abundance and dispersion parameters.</p>
    </div>

    <pre class="usage"><span class='fu'>tax_model</span><span class='op'>(</span>
  <span class='va'>ps</span>,
  <span class='va'>tax_level</span>,
  type <span class='op'>=</span> <span class='st'>"bbdml"</span>,
  variables <span class='op'>=</span> <span class='cn'>NULL</span>,
  formula <span class='op'>=</span> <span class='cn'>NULL</span>,
  taxa <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span>

<span class='fu'>taxatree_models</span><span class='op'>(</span>
  <span class='va'>ps</span>,
  tax_levels <span class='op'>=</span> <span class='cn'>NULL</span>,
  type <span class='op'>=</span> <span class='st'>"bbdml"</span>,
  variables <span class='op'>=</span> <span class='cn'>NULL</span>,
  formula <span class='op'>=</span> <span class='cn'>NULL</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>ps</th>
      <td><p>phyloseq object</p></td>
    </tr>
    <tr>
      <th>tax_level</th>
      <td><p>name of taxonomic rank to aggregate to and model taxa at</p></td>
    </tr>
    <tr>
      <th>type</th>
      <td><p>name of modelling function to use</p></td>
    </tr>
    <tr>
      <th>variables</th>
      <td><p>vector of variable names to use in statistical model as right hand side (ignored if formula given)</p></td>
    </tr>
    <tr>
      <th>formula</th>
      <td><p>(alternative to variables arg) right hand side of a formula, as a formula object or character value</p></td>
    </tr>
    <tr>
      <th>taxa</th>
      <td><p>taxa to model (named, numbered, logical selection, or defaulting to all if NULL)</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>message about progress and any taxa name modifications</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>extra args passed directly to modelling function</p></td>
    </tr>
    <tr>
      <th>tax_levels</th>
      <td><p>names of ranks to model taxa at (or their index) or defaults to all ranks except the first</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>named list of model objects or list of lists</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>tax_model</code> and <code>taxatree_models</code> can use parallel processing with the <code>future</code> package.
This can speed up analysis if you have many taxa to model.
Run a line like this beforehand: <code><a href='https://rdrr.io/pkg/future/man/plan.html'>future::plan(future::multisession, workers = 3)</a></code></p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='taxatree_plots.html'>taxatree_plots</a></code> for how to plot the output of <code>taxatree_models</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># corncob stats</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'>corncob</span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://dplyr.tidyverse.org'>dplyr</a></span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Attaching package: ‘dplyr’</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:stats’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    filter, lag</span></div><div class='output co'>#&gt; <span class='message'>The following objects are masked from ‘package:base’:</span>
#&gt; <span class='message'></span>
#&gt; <span class='message'>    intersect, setdiff, setequal, union</span></div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>dietswap</span>, package <span class='op'>=</span> <span class='st'>"microbiome"</span><span class='op'>)</span>
<span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='va'>dietswap</span>

<span class='co'># create some binary variables for easy visualisation</span>
<span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='va'>ps</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='ps_mutate.html'>ps_mutate</a></span><span class='op'>(</span>
  female <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>==</span> <span class='st'>"female"</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='cn'>NaN</span><span class='op'>)</span>,
  overweight <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>bmi_group</span> <span class='op'>==</span> <span class='st'>"overweight"</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='cn'>NaN</span><span class='op'>)</span>,
  obese <span class='op'>=</span> <span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>bmi_group</span> <span class='op'>==</span> <span class='st'>"obese"</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='cn'>NaN</span><span class='op'>)</span>
<span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Loading required package: phyloseq</span></div><div class='input'>
<span class='co'># This example HITChip dataset has some taxa with the same name for phylum and family...</span>
<span class='co'># We can fix problems like this with the tax_prepend_ranks function</span>
<span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='fu'><a href='tax_prepend_ranks.html'>tax_prepend_ranks</a></span><span class='op'>(</span><span class='va'>ps</span><span class='op'>)</span>

<span class='co'># filter out rare taxa (it is often difficult to fit multivariable models to rare taxa)</span>
<span class='va'>ps</span> <span class='op'>&lt;-</span> <span class='va'>ps</span> <span class='op'>%&gt;%</span> <span class='fu'><a href='tax_filter.html'>tax_filter</a></span><span class='op'>(</span>min_prevalence <span class='op'>=</span> <span class='fl'>0.1</span>, min_total_abundance <span class='op'>=</span> <span class='fl'>10000</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Proportional min_prevalence given: 0.1 --&gt; min 23/222 samples.</span></div><div class='input'>
<span class='co'># specify variables used for modelling</span>
<span class='va'>VARS</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"female"</span>, <span class='st'>"overweight"</span>, <span class='st'>"obese"</span><span class='op'>)</span>

<span class='co'># Model first 3 genera using all VARS as predictors (just for a quick test)</span>
<span class='va'>models</span> <span class='op'>&lt;-</span> <span class='fu'>tax_model</span><span class='op'>(</span><span class='va'>ps</span>, tax_level <span class='op'>=</span> <span class='st'>"Genus"</span>, taxa <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, variables <span class='op'>=</span> <span class='va'>VARS</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Modelling: G: Akkermansia</span></div><div class='output co'>#&gt; <span class='message'>Modelling: G: Allistipes et rel.</span></div><div class='output co'>#&gt; <span class='message'>Modelling: G: Anaerostipes caccae et rel.</span></div><div class='input'><span class='co'># Alternative method using formula arg instead of variables to produce identical results</span>
<span class='va'>models2</span> <span class='op'>&lt;-</span>
  <span class='fu'>tax_model</span><span class='op'>(</span><span class='va'>ps</span>, tax_level <span class='op'>=</span> <span class='st'>"Genus"</span>, taxa <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, formula <span class='op'>=</span> <span class='op'>~</span> <span class='va'>female</span> <span class='op'>+</span> <span class='va'>overweight</span> <span class='op'>+</span> <span class='va'>obese</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Modelling: G: Akkermansia</span></div><div class='output co'>#&gt; <span class='message'>Modelling: G: Allistipes et rel.</span></div><div class='output co'>#&gt; <span class='message'>Modelling: G: Anaerostipes caccae et rel.</span></div><div class='input'><span class='fu'><a href='https://rdrr.io/r/base/all.equal.html'>all.equal</a></span><span class='op'>(</span><span class='va'>models</span>, <span class='va'>models2</span><span class='op'>)</span> <span class='co'># should be TRUE</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'><span class='co'># Model only one genus, NOTE the modified name,</span>
<span class='co'># which was returned by tax_prepend_ranks defaults</span>
<span class='va'>models3</span> <span class='op'>&lt;-</span> <span class='va'>ps</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tax_model</span><span class='op'>(</span>tax_level <span class='op'>=</span> <span class='st'>"Genus"</span>, taxa <span class='op'>=</span> <span class='st'>"G: Bacteroides fragilis et rel."</span>, variables <span class='op'>=</span> <span class='va'>VARS</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Modelling: G: Bacteroides fragilis et rel.</span></div><div class='input'><span class='co'># Model all taxa at multiple taxonomic ranks (ranks 1 and 2)</span>
<span class='co'># using only female variable as predictor</span>
<span class='va'>models4</span> <span class='op'>&lt;-</span> <span class='fu'>taxatree_models</span><span class='op'>(</span><span class='va'>ps</span>, tax_levels <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>2</span>, formula <span class='op'>=</span> <span class='op'>~</span><span class='va'>female</span>, verbose <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>2021-04-01 09:24:47 - modelling at level: Phylum</span></div><div class='output co'>#&gt; <span class='message'>2021-04-01 09:24:47 - modelling at level: Family</span></div><div class='input'>
<span class='co'># modelling proportion with simple linear regression is also possible via type = lm</span>
<span class='co'># and transforming the taxa to compositional first</span>
<span class='va'>models_lm</span> <span class='op'>&lt;-</span> <span class='va'>ps</span> <span class='op'>%&gt;%</span>
  <span class='fu'>microbiome</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/microbiome/man/transform.html'>transform</a></span><span class='op'>(</span><span class='st'>"compositional"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>tax_model</span><span class='op'>(</span>tax_level <span class='op'>=</span> <span class='st'>"Genus"</span>, taxa <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>, variables <span class='op'>=</span> <span class='va'>VARS</span>, type <span class='op'>=</span> <span class='st'>"lm"</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Modelling: G: Akkermansia</span></div><div class='output co'>#&gt; <span class='message'>Modelling: G: Allistipes et rel.</span></div><div class='output co'>#&gt; <span class='message'>Modelling: G: Anaerostipes caccae et rel.</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Barnett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


