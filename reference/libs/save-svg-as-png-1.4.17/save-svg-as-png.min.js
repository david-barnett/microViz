"use strict";!function(){var i="undefined"!=typeof exports&&exports||"undefined"!=typeof define&&{}||this||window;"undefined"!=typeof define&&define("save-svg-as-png",[],function(){return i}),i.default=i;function r(e){return e instanceof HTMLElement||e instanceof SVGElement}function g(e){if(!r(e))throw new Error("an HTMLElement or SVGElement is required; got "+e)}function o(n){return new Promise(function(e,t){r(n)?e(n):t(new Error("an HTMLElement or SVGElement is required; got "+n))})}function p(e,t,n){return null==(n=e.viewBox&&e.viewBox.baseVal&&e.viewBox.baseVal[n]||null!==t.getAttribute(n)&&!t.getAttribute(n).match(/%$/)&&parseInt(t.getAttribute(n))||e.getBoundingClientRect()[n]||parseInt(t.style[n])||parseInt(window.getComputedStyle(e).getPropertyValue(n)))||isNaN(parseFloat(n))?0:n}function a(e){for(var t=window.atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],e=new ArrayBuffer(t.length),r=new Uint8Array(e),o=0;o<t.length;o++)r[o]=t.charCodeAt(o);return new Blob([e],{type:n})}function f(e,t){if((r=(r=e.cssText.match(u))&&r[1]||"")&&!r.match(/^data:/)&&"about:blank"!==r){var n,r=r.startsWith("../")?t+"/../"+r:r.startsWith("./")?t+"/."+r:r;return{text:e.cssText,format:(n=r,(e=Object.keys(l).filter(function(e){return 0<n.indexOf("."+e)}).map(function(e){return l[e]}))?e[0]:(console.error("Unknown font format for "+n+". Fonts may not be working correctly."),"application/octet-stream")),url:r}}}function n(e){return Promise.all(Array.from(e.querySelectorAll("image")).map(function(o){var e,i=o.getAttributeNS("http://www.w3.org/1999/xlink","href")||o.getAttribute("href");return i?((e=i)&&0===e.lastIndexOf("http",0)&&-1===e.lastIndexOf(window.location.host)&&(i+=(-1===i.indexOf("?")?"?":"&")+"t="+(new Date).valueOf()),new Promise(function(e,t){var n=document.createElement("canvas"),r=new Image;r.crossOrigin="anonymous",r.src=i,r.onerror=function(){return t(new Error("Could not load "+i))},r.onload=function(){n.width=r.width,n.height=r.height,n.getContext("2d").drawImage(r,0,0),o.setAttributeNS("http://www.w3.org/1999/xlink","href",n.toDataURL("image/png")),e(!0)}})):Promise.resolve(null)}))}function d(e){return Promise.all(e.map(function(r){return new Promise(function(t,e){if(c[r.url])return t(c[r.url]);var n=new XMLHttpRequest;n.addEventListener("load",function(){var e=function(e){for(var t="",n=new Uint8Array(e),r=0;r<n.byteLength;r++)t+=String.fromCharCode(n[r]);return window.btoa(t)}(n.response),e=r.text.replace(u,'url("data:'+r.format+";base64,"+e+'")')+"\n";c[r.url]=e,t(e)}),n.addEventListener("error",function(e){console.warn("Failed to load font from: "+r.url,e),c[r.url]=null,t(null)}),n.addEventListener("abort",function(e){console.warn("Aborted loading font from: "+r.url,e),t(null)}),n.open("GET",r.url),n.responseType="arraybuffer",n.send()})})).then(function(e){return e.filter(function(e){return e}).join("")})}function m(r,e){var t=e||{},n=t.selectorRemap,o=t.modifyStyle,i=t.modifyCss,e=t.fonts,a=t.excludeUnusedCss,s=i||function(e,t){return(n?n(e):e)+"{"+(o?o(t):t)+"}\n"},u=[],l=void 0===e,c=e||[];return(h=h||Array.from(document.styleSheets).map(function(t){try{return{rules:t.cssRules,href:t.href}}catch(e){return console.warn("Stylesheet could not be loaded: "+t.href,e),{}}})).forEach(function(e){var t=e.rules,n=e.href;t&&Array.from(t).forEach(function(e){var t;void 0!==e.style&&(!function(e,t){if(t)try{return e.querySelector(t)||e.parentNode&&e.parentNode.querySelector(t)}catch(e){console.warn('Invalid CSS selector "'+t+'"',e)}}(r,e.selectorText)?l&&e.cssText.match(/^@font-face/)?(t=f(e,n))&&c.push(t):a||u.push(e.cssText):u.push(s(e.selectorText,e.style.cssText)))})}),d(c).then(function(e){return u.join("\n")+e})}function s(){if(!(navigator.msSaveOrOpenBlob||"download"in document.createElement("a")))return{popup:window.open()}}var v="http://www.w3.org/2000/xmlns/",b="http://www.w3.org/2000/svg",u=/url\(["']?(.+?)["']?\)/,l={woff2:"font/woff2",woff:"font/woff",otf:"application/x-font-opentype",ttf:"application/x-font-ttf",eot:"application/vnd.ms-fontobject",sfnt:"application/font-sfnt",svg:"image/svg+xml"},c={},h=null;i.prepareSvg=function(i,a,s){g(i);var e=a||{},t=e.left,u=void 0===t?0:t,t=e.top,l=void 0===t?0:t,c=e.width,f=e.height,t=e.scale,d=void 0===t?1:t,t=e.responsive,h=void 0!==t&&t,e=e.excludeCss,w=void 0!==e&&e;return n(i).then(function(){var n=i.cloneNode(!0);n.style.backgroundColor=(a||{}).backgroundColor||i.style.backgroundColor;var e=function(e,t,n,r){if("svg"===e.tagName)return{width:n||p(e,t,"width"),height:r||p(e,t,"height")};if(e.getBBox){r=e.getBBox(),t=r.x,e=r.y;return{width:t+r.width,height:e+r.height}}}(i,n,c,f),r=e.width,o=e.height;if("svg"!==i.tagName){if(!i.getBBox)return void console.error("Attempted to render non-SVG element",i);null!=n.getAttribute("transform")&&n.setAttribute("transform",n.getAttribute("transform").replace(/translate\(.*?\)/,""));var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.appendChild(n),n=t}if(n.setAttribute("version","1.1"),n.setAttribute("viewBox",[u,l,r,o].join(" ")),n.getAttribute("xmlns")||n.setAttributeNS(v,"xmlns",b),n.getAttribute("xmlns:xlink")||n.setAttributeNS(v,"xmlns:xlink","http://www.w3.org/1999/xlink"),h?(n.removeAttribute("width"),n.removeAttribute("height"),n.setAttribute("preserveAspectRatio","xMinYMin meet")):(n.setAttribute("width",r*d),n.setAttribute("height",o*d)),Array.from(n.querySelectorAll("foreignObject > *")).forEach(function(e){e.setAttributeNS(v,"xmlns","svg"===e.tagName?b:"http://www.w3.org/1999/xhtml")}),!w)return m(i,a).then(function(e){var t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML="<![CDATA[\n"+e+"\n]]>";e=document.createElement("defs");e.appendChild(t),n.insertBefore(e,n.firstChild);e=document.createElement("div");e.appendChild(n);e=e.innerHTML.replace(/NS\d+:href/gi,'xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href');if("function"!=typeof s)return{src:e,width:r,height:o};s(e,r,o)});t=document.createElement("div");t.appendChild(n);t=t.innerHTML;if("function"!=typeof s)return{src:t,width:r,height:o};s(t,r,o)})},i.svgAsDataUri=function(e,t,r){return g(e),i.prepareSvg(e,t).then(function(e){var t=e.src,n=e.width,e=e.height,t="data:image/svg+xml;base64,"+window.btoa(decodeURIComponent(encodeURIComponent('<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>'+t).replace(/%([0-9A-F]{2})/g,function(e,t){t=String.fromCharCode("0x"+t);return"%"===t?"%25":t})));return"function"==typeof r&&r(t,n,e),t})},i.svgAsPngUri=function(e,t,a){g(e);function o(e){var t=e.src,n=e.width,r=e.height,o=document.createElement("canvas"),i=o.getContext("2d"),e=window.devicePixelRatio||1;o.width=n*e,o.height=r*e,o.style.width=o.width+"px",o.style.height=o.height+"px",i.setTransform(e,0,0,e,0,0),l?l(o,t):i.drawImage(t,0,0),t=void 0;try{t=o.toDataURL(s,u)}catch(e){if("undefined"!=typeof SecurityError&&e instanceof SecurityError||"SecurityError"===e.name)return void console.error("Rendered SVG images cannot be downloaded in this browser.");throw e}return"function"==typeof a&&a(t,o.width,o.height),Promise.resolve(t)}var n=t||{},r=n.encoderType,s=void 0===r?"image/png":r,r=n.encoderOptions,u=void 0===r?.8:r,l=n.canvg;return l?i.prepareSvg(e,t).then(o):i.svgAsDataUri(e,t).then(function(r){return new Promise(function(e,t){var n=new Image;n.onload=function(){return e(o({src:n,width:n.width,height:n.height}))},n.onerror=function(){t("There was an error loading the data URI as an image on the following SVG\n"+window.atob(r.slice(26))+"Open the following link to see browser's diagnosis\n"+r)},n.src=r})})},i.download=function(e,t,n){if(navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(a(t),e);else{var r=document.createElement("a");if("download"in r){r.download=e,r.style.display="none",document.body.appendChild(r);try{var o=a(t),i=URL.createObjectURL(o);r.href=i,r.onclick=function(){return requestAnimationFrame(function(){return URL.revokeObjectURL(i)})}}catch(e){console.error(e),console.warn("Error while getting object URL. Falling back to string URL."),r.href=t}r.click(),document.body.removeChild(r)}else n&&n.popup&&(n.popup.document.title=e,n.popup.location.replace(t))}},i.saveSvg=function(e,t,n){var r=s();return o(e).then(function(e){return i.svgAsDataUri(e,n||{})}).then(function(e){return i.download(t,e,r)})},i.saveSvgAsPng=function(e,t,n){var r=s();return o(e).then(function(e){return i.svgAsPngUri(e,n||{})}).then(function(e){return i.download(t,e,r)})}}();