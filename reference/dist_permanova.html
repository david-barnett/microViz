<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Calculate PERMANOVA after dist_calc() — dist_permanova • microViz</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Calculate PERMANOVA after dist_calc() — dist_permanova" />
<meta property="og:description" content="dist_permanova runs a Permutational Multivariate ANOVA (aka Non-parametric MANOVA).
This is way to test for the statistical significance of (independent)
associations between variables in your phyloseq::sample_data(),
and a microbiota distance matrix you have already calculated with dist_calc().
This function is a wrapper around vegan's adonis2() function. See ?vegan::adonis2() for more insight.
You can also read this excellent book chapter on PERMANOVA by Marti Anderson:
https://doi.org/10.1002/9781118445112.stat07841
Or this NPMANOVA page on GUSTA ME:
https://sites.google.com/site/mb3gustame/hypothesis-tests/manova/npmanova" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">microViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/articles/microViz.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/Interactive-Ordination.html">Interactive Ordination Plot</a>
    </li>
    <li>
      <a href="../articles/articles/Visualising-compositions.html">Visualising compositions</a>
    </li>
    <li>
      <a href="../articles/articles/phyloseq.html">Working with phyloseq objects</a>
    </li>
    <li>
      <a href="../articles/articles/tax-fixing.html">Fixing your tax_table</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/david-barnett/microViz/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Calculate PERMANOVA after dist_calc()</h1>
    <small class="dont-index">Source: <a href='https://github.com/david-barnett/microViz/blob/master/R/dist_permanova.R'><code>R/dist_permanova.R</code></a></small>
    <div class="hidden name"><code>dist_permanova.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><code>dist_permanova</code> runs a Permutational Multivariate ANOVA (aka Non-parametric MANOVA).
This is way to test for the statistical significance of (independent)
associations between variables in your phyloseq::sample_data(),
and a microbiota distance matrix you have already calculated with dist_calc().</p>
<p>This function is a wrapper around vegan's <code><a href='https://rdrr.io/pkg/vegan/man/adonis.html'>adonis2()</a></code> function. See <code>?vegan::adonis2()</code> for more insight.</p>
<p>You can also read this excellent book chapter on PERMANOVA by Marti Anderson:
<a href='https://doi.org/10.1002/9781118445112.stat07841'>https://doi.org/10.1002/9781118445112.stat07841</a></p>
<p>Or this NPMANOVA page on GUSTA ME:
<a href='https://sites.google.com/site/mb3gustame/hypothesis-tests/manova/npmanova'>https://sites.google.com/site/mb3gustame/hypothesis-tests/manova/npmanova</a></p>
    </div>

    <pre class="usage"><span class='fu'>dist_permanova</span><span class='op'>(</span>
  <span class='va'>data</span>,
  variables <span class='op'>=</span> <span class='cn'>NULL</span>,
  interactions <span class='op'>=</span> <span class='cn'>NULL</span>,
  complete_cases <span class='op'>=</span> <span class='cn'>TRUE</span>,
  n_processes <span class='op'>=</span> <span class='fl'>1</span>,
  n_perms <span class='op'>=</span> <span class='fl'>999</span>,
  seed <span class='op'>=</span> <span class='cn'>NULL</span>,
  by <span class='op'>=</span> <span class='st'>"margin"</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>ps_extra output from dist_calc()</p></td>
    </tr>
    <tr>
      <th>variables</th>
      <td><p>character vector of variables to include in model or character representation of the right-hand side of a formula, e.g "varA + varB + varA:varB"</p></td>
    </tr>
    <tr>
      <th>interactions</th>
      <td><p>optional argument to define any interactions between variables, written in the style of e.g. "var_a * var_b"</p></td>
    </tr>
    <tr>
      <th>complete_cases</th>
      <td><p>if TRUE, drops observations if they contain missing values (otherwise stops if missings are detected)</p></td>
    </tr>
    <tr>
      <th>n_processes</th>
      <td><p>how many parallel processes to use? (on windows this uses parallel::makePSOCKcluster())</p></td>
    </tr>
    <tr>
      <th>n_perms</th>
      <td><p>how many permutations? e.g. 9999. Less is faster but more is better!</p></td>
    </tr>
    <tr>
      <th>seed</th>
      <td><p>set a random number generator seed to ensure you get the same results each run</p></td>
    </tr>
    <tr>
      <th>by</th>
      <td><p>passed to vegan::adonis2() <code>by</code> argument: what type of sums of squares to calculate? "margin" or "terms"</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>sends messages about progress if TRUE</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments are passed directly to vegan::adonis2() (e.g. strata, add, sqrt.dist etc.)</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>ps_extra list containing permanova results and (filtered) input objects</p>
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The variables argument will be collapsed into one string (if length &gt; 1) by pasting together, separated by "+".
Any interaction terms described in the interactions argument will be pasted onto the end of the pasted variables argument.
Alternatively, you can supply the complete right hand side of the formula yourself e.g variables = "varA + varB + varC<em>varD"
Watch out, if any of your variable names contain characters that would normally separate variables in a formula then
you should rename the offending variable (e.g. avoid any of "+" "</em>" "|" or ":" ) otherwise permanova will split that variable into pieces.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='dist_calc.html'>dist_calc</a></code> for calculating the required distance matrix input</p>
<p><code><a href='ord_plot.html'>ord_plot</a></code> with constraints as a way to visualise the microbial associations of significant predictors</p>
<p><code>vegan::<a href='https://rdrr.io/pkg/vegan/man/adonis.html'>adonis2</a></code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"dietswap"</span>, package <span class='op'>=</span> <span class='st'>"microbiome"</span><span class='op'>)</span>

<span class='co'># add some missings to demonstrate automated removal</span>
<span class='fu'>phyloseq</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html'>sample_data</a></span><span class='op'>(</span><span class='va'>dietswap</span><span class='op'>)</span><span class='op'>$</span><span class='va'>sex</span><span class='op'>[</span><span class='fl'>3</span><span class='op'>:</span><span class='fl'>6</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>

<span class='co'># compute distance</span>
<span class='va'>testDist</span> <span class='op'>&lt;-</span> <span class='va'>dietswap</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='tax_agg.html'>tax_agg</a></span><span class='op'>(</span><span class='st'>"Genus"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='tax_transform.html'>tax_transform</a></span><span class='op'>(</span><span class='st'>"identity"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='dist_calc.html'>dist_calc</a></span><span class='op'>(</span><span class='st'>"bray"</span><span class='op'>)</span>

<span class='va'>PERM</span> <span class='op'>&lt;-</span> <span class='va'>testDist</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dist_permanova</span><span class='op'>(</span>
    seed <span class='op'>=</span> <span class='fl'>1</span>,
    variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"sex"</span>, <span class='st'>"bmi_group"</span><span class='op'>)</span>,
    n_processes <span class='op'>=</span> <span class='fl'>1</span>,
    n_perms <span class='op'>=</span> <span class='fl'>99</span> <span class='co'># only 99 perms used in examples for speed (use 9999+!)</span>
  <span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Dropping samples with missings: 4</span></div><div class='output co'>#&gt; <span class='message'>2021-04-15 15:06:55 - Starting PERMANOVA with 99 perms with 1 processes</span></div><div class='output co'>#&gt; <span class='message'>2021-04-15 15:06:55 - Finished PERMANOVA</span></div><div class='input'><span class='va'>PERM</span>
</div><div class='output co'>#&gt; ps_extra object - a list with phyloseq and extras:
#&gt; 
#&gt; phyloseq-class experiment-level object
#&gt; otu_table()   OTU Table:         [ 130 taxa and 218 samples ]
#&gt; sample_data() Sample Data:       [ 218 samples by 8 sample variables ]
#&gt; tax_table()   Taxonomy Table:    [ 130 taxa by 3 taxonomic ranks ]
#&gt; 
#&gt; phyloseq info:
#&gt; tax_agg = Genus tax_transform = identity
#&gt; 
#&gt; bray distance matrix of size 218 
#&gt; 0.7639533 0.731024 0.7283254 0.6637252 0.7437293 ...
#&gt; 
#&gt; permanova:
#&gt; Permutation test for adonis under reduced model
#&gt; Marginal effects of terms
#&gt; Permutation: free
#&gt; Number of permutations: 99
#&gt; 
#&gt; vegan::adonis2(formula = formula, data = metadata, permutations = n_perms, by = by, parallel = parall)
#&gt;            Df SumOfSqs      R2      F Pr(&gt;F)   
#&gt; sex         1    0.361 0.00933 2.1539   0.10 . 
#&gt; bmi_group   2    2.377 0.06143 7.0888   0.01 **
#&gt; Residual  214   35.874 0.92720                 
#&gt; Total     217   38.691 1.00000                 
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
#&gt; </div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>PERM</span>, max.level <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; List of 5
#&gt;  $ ps       :Formal class 'phyloseq' [package "phyloseq"] with 5 slots
#&gt;  $ dist     : 'dist' num [1:23653] 0.764 0.731 0.728 0.664 0.744 ...
#&gt;   ..- attr(*, "Labels")= chr [1:218] "Sample-1" "Sample-2" "Sample-7" "Sample-8" ...
#&gt;   ..- attr(*, "Size")= int 218
#&gt;   ..- attr(*, "call")= language as.dist.default(m = as.matrix(distMat)[keepers, keepers])
#&gt;   ..- attr(*, "Diag")= logi FALSE
#&gt;   ..- attr(*, "Upper")= logi FALSE
#&gt;  $ ord      : NULL
#&gt;  $ info     : 'ps_extra_info' Named chr [1:7] "Genus" "identity" NA "bray" ...
#&gt;   ..- attr(*, "names")= chr [1:7] "tax_agg" "tax_transform" "tax_scale" "distMethod" ...
#&gt;  $ permanova:Classes ‘anova.cca’, ‘anova’ and 'data.frame':	4 obs. of  5 variables:
#&gt;   ..- attr(*, "heading")= chr [1:2] "Permutation test for adonis under reduced model\nMarginal effects of terms\nPermutation: free\nNumber of permutations: 99\n" "vegan::adonis2(formula = formula, data = metadata, permutations = n_perms, by = by, parallel = parall)"
#&gt;   ..- attr(*, "F.perm")= num [1:99, 1:2] 1.892 0.748 0.283 2.748 0.956 ...
#&gt;   ..- attr(*, "Random.seed")= int [1:626] 10403 624 -169270483 -442010614 -603558397 -222347416 1489374793 865871222 1734802815 98005428 ...
#&gt;   ..- attr(*, "control")=List of 12
#&gt;   .. ..- attr(*, "class")= chr "how"
#&gt;  - attr(*, "class")= chr [1:2] "ps_extra" "list"</div><div class='input'>
<span class='co'># try permanova with interaction terms</span>
<span class='va'>PERM2</span> <span class='op'>&lt;-</span> <span class='va'>testDist</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dist_permanova</span><span class='op'>(</span>
    seed <span class='op'>=</span> <span class='fl'>1</span>,
    variables <span class='op'>=</span> <span class='st'>"nationality + sex * bmi_group"</span>,
    n_processes <span class='op'>=</span> <span class='fl'>1</span>, n_perms <span class='op'>=</span> <span class='fl'>99</span>
  <span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Dropping samples with missings: 4</span></div><div class='output co'>#&gt; <span class='message'>2021-04-15 15:06:55 - Starting PERMANOVA with 99 perms with 1 processes</span></div><div class='output co'>#&gt; <span class='message'>2021-04-15 15:06:56 - Finished PERMANOVA</span></div><div class='input'><span class='va'>PERM2</span><span class='op'>$</span><span class='va'>permanova</span>
</div><div class='output co'>#&gt; Permutation test for adonis under reduced model
#&gt; Marginal effects of terms
#&gt; Permutation: free
#&gt; Number of permutations: 99
#&gt; 
#&gt; vegan::adonis2(formula = formula, data = metadata, permutations = n_perms, by = by, parallel = parall)
#&gt;                Df SumOfSqs      R2       F Pr(&gt;F)   
#&gt; nationality     1    4.859 0.12558 34.2219   0.01 **
#&gt; sex:bmi_group   1    0.321 0.00828  2.2576   0.06 . 
#&gt; Residual      212   30.099 0.77794                  
#&gt; Total         217   38.691 1.00000                  
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class='input'>
<span class='co'># specify the same model in alternative way</span>
<span class='va'>PERM3</span> <span class='op'>&lt;-</span> <span class='va'>testDist</span> <span class='op'>%&gt;%</span>
  <span class='fu'>dist_permanova</span><span class='op'>(</span>
    seed <span class='op'>=</span> <span class='fl'>1</span>,
    variables <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"nationality"</span>, <span class='st'>"sex"</span>, <span class='st'>"bmi_group"</span><span class='op'>)</span>,
    interactions <span class='op'>=</span> <span class='st'>"sex * bmi_group"</span>,
    n_processes <span class='op'>=</span> <span class='fl'>1</span>, n_perms <span class='op'>=</span> <span class='fl'>99</span>
  <span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Dropping samples with missings: 4</span></div><div class='output co'>#&gt; <span class='message'>2021-04-15 15:06:56 - Starting PERMANOVA with 99 perms with 1 processes</span></div><div class='output co'>#&gt; <span class='message'>2021-04-15 15:06:56 - Finished PERMANOVA</span></div><div class='input'><span class='va'>PERM3</span><span class='op'>$</span><span class='va'>permanova</span>
</div><div class='output co'>#&gt; Permutation test for adonis under reduced model
#&gt; Marginal effects of terms
#&gt; Permutation: free
#&gt; Number of permutations: 99
#&gt; 
#&gt; vegan::adonis2(formula = formula, data = metadata, permutations = n_perms, by = by, parallel = parall)
#&gt;                Df SumOfSqs      R2       F Pr(&gt;F)   
#&gt; nationality     1    4.859 0.12558 34.2219   0.01 **
#&gt; sex:bmi_group   1    0.321 0.00828  2.2576   0.06 . 
#&gt; Residual      212   30.099 0.77794                  
#&gt; Total         217   38.691 1.00000                  
#&gt; ---
#&gt; Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/base/identical.html'>identical</a></span><span class='op'>(</span><span class='va'>PERM3</span>, <span class='va'>PERM2</span><span class='op'>)</span> <span class='co'># TRUE</span>
</div><div class='output co'>#&gt; [1] TRUE</div><div class='input'>
<span class='co'># take same distance matrix used for the permanova and plot an ordination</span>
<span class='va'>PERM2</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='ord_calc.html'>ord_calc</a></span><span class='op'>(</span>method <span class='op'>=</span> <span class='st'>"PCoA"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='ord_plot.html'>ord_plot</a></span><span class='op'>(</span>color <span class='op'>=</span> <span class='st'>"bmi_group"</span><span class='op'>)</span>
</div><div class='img'><img src='dist_permanova-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># this trick ensures any samples dropped from the permanova</span>
<span class='co'># for having missing values in the covariates are NOT included</span>
<span class='co'># in the corresponding ordination plot</span>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Barnett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


