<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Draw heatmap of microbiome composition across samples — comp_heatmap • microViz</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Draw heatmap of microbiome composition across samples — comp_heatmap"><meta property="og:description" content='Heatmap made with ComplexHeatmap::Heatmap(),
with optional annotation of taxa prevalence/abundance,
and/or other sample data.
Transform your data with tax_transform() prior to plotting
(and/or scale with tax_scale()).
See the heatmaps vignette for more examples of use.
Plotting "compositional" data can give an idea of the dominant taxa in each sample.
Plotting some form of log or clr transformed (or scaled) microbial features can highlight
other patterns.
The data will be ordered via your selected seriation methods and distances
on either the transformed data (default) or the original count data
(or with any other transformation).
Any cell numbers printed can be transformed independently of the colour scheme,
and do not affect ordering.'><meta property="og:image" content="https://david-barnett.github.io/microViz/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2YQ669S4V5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2YQ669S4V5');
</script></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">microViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.12.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/shao19-analyses.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/web-only/phyloseq.html">Working with phyloseq objects</a>
    </li>
    <li>
      <a href="../articles/web-only/tax-fixing.html">Fixing your tax_table</a>
    </li>
    <li>
      <a href="../articles/web-only/ordination.html">Ordination plots</a>
    </li>
    <li>
      <a href="../articles/web-only/ordination-interactive.html">Interactive ordination plots</a>
    </li>
    <li>
      <a href="../articles/web-only/compositions.html">Visualising compositions with barplots</a>
    </li>
    <li>
      <a href="../articles/web-only/heatmaps.html">Heatmaps of microbiome composition or correlation</a>
    </li>
    <li>
      <a href="../articles/web-only/modelling-taxa.html">Statistical modelling of individual taxa</a>
    </li>
    <li>
      <a href="../articles/web-only/videos.html">Tutorial video</a>
    </li>
    <li>
      <a href="../articles/ps_extra-replaced.html">Upgrading to microViz version 0.10.0</a>
    </li>
    <li>
      <a href="../articles/web-only/atlas1006.html">Example analyses with atlas1006 data</a>
    </li>
  </ul></li>
<li>
  <a href="../articles/learn/exercises.html">Learn</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
<li class="dropdown-header">
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/david-barnett/microViz/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>

    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Draw heatmap of microbiome composition across samples</h1>
    <small class="dont-index">Source: <a href="https://github.com/david-barnett/microViz/blob/main/R/heatmaps.R" class="external-link"><code>R/heatmaps.R</code></a></small>
    <div class="hidden name"><code>comp_heatmap.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Heatmap made with <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap()</a></code>,
with optional annotation of taxa prevalence/abundance,
and/or other sample data.</p>
<p>Transform your data with <code><a href="tax_transform.html">tax_transform()</a></code> prior to plotting
(and/or scale with <code><a href="tax_scale.html">tax_scale()</a></code>).</p>
<p>See the heatmaps vignette for more examples of use.</p>
<p>Plotting "compositional" data can give an idea of the dominant taxa in each sample.
Plotting some form of log or clr transformed (or scaled) microbial features can highlight
other patterns.</p>
<p>The data will be ordered via your selected seriation methods and distances
on either the transformed data (default) or the original count data
(or with any other transformation).</p>
<p>Any cell numbers printed can be transformed independently of the colour scheme,
and do not affect ordering.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">comp_heatmap</span><span class="op">(</span></span>
<span>  <span class="va">data</span>,</span>
<span>  taxa <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  taxa_side <span class="op">=</span> <span class="st">"right"</span>,</span>
<span>  tax_anno <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  taxon_renamer <span class="op">=</span> <span class="va">identity</span>,</span>
<span>  samples <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  sample_side <span class="op">=</span> <span class="fu"><a href="adjacent_side.html">adjacent_side</a></span><span class="op">(</span><span class="va">taxa_side</span><span class="op">)</span>,</span>
<span>  sample_anno <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_names_show <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  colors <span class="op">=</span> <span class="fu"><a href="heat_palette.html">heat_palette</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Rocket"</span>, rev <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  numbers <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_seriation <span class="op">=</span> <span class="st">"OLO_ward"</span>,</span>
<span>  sample_ser_dist <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  sample_ser_counts <span class="op">=</span> <span class="op">!</span><span class="va">sample_ser_dist</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"euclidean"</span>, <span class="st">"maximum"</span>, <span class="st">"manhattan"</span>,</span>
<span>    <span class="st">"canberra"</span>, <span class="st">"binary"</span><span class="op">)</span>,</span>
<span>  sample_ser_trans <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tax_seriation <span class="op">=</span> <span class="st">"OLO_ward"</span>,</span>
<span>  tax_ser_dist <span class="op">=</span> <span class="st">"euclidean"</span>,</span>
<span>  tax_ser_counts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  tax_ser_trans <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numbers_trans <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  numbers_zero_replace <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  numbers_use_counts <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  grid_col <span class="op">=</span> <span class="st">"white"</span>,</span>
<span>  grid_lwd <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  name <span class="op">=</span> <span class="st">"Abd."</span>,</span>
<span>  anno_tax <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>phyloseq or phyloseq extra</p></dd>


<dt id="arg-taxa">taxa<a class="anchor" aria-label="anchor" href="#arg-taxa"></a></dt>
<dd><p>list of taxa to include, or NA for all</p></dd>


<dt id="arg-taxa-side">taxa_side<a class="anchor" aria-label="anchor" href="#arg-taxa-side"></a></dt>
<dd><p>"top"/"right"/"bottom"/"left": controls heatmap orientation and where any
annotations specified in tax_anno are placed</p></dd>


<dt id="arg-tax-anno">tax_anno<a class="anchor" aria-label="anchor" href="#arg-tax-anno"></a></dt>
<dd><p>NULL or annotation function for taxa: taxAnnotation() output.</p></dd>


<dt id="arg-taxon-renamer">taxon_renamer<a class="anchor" aria-label="anchor" href="#arg-taxon-renamer"></a></dt>
<dd><p>function to rename taxa before plotting</p></dd>


<dt id="arg-samples">samples<a class="anchor" aria-label="anchor" href="#arg-samples"></a></dt>
<dd><p>list of samples to include on plot</p></dd>


<dt id="arg-sample-side">sample_side<a class="anchor" aria-label="anchor" href="#arg-sample-side"></a></dt>
<dd><p>which side to show any sample annotation on, must be adjacent to taxa_side</p></dd>


<dt id="arg-sample-anno">sample_anno<a class="anchor" aria-label="anchor" href="#arg-sample-anno"></a></dt>
<dd><p>NULL or annotation function for samples: sampleAnnotation() output.</p></dd>


<dt id="arg-sample-names-show">sample_names_show<a class="anchor" aria-label="anchor" href="#arg-sample-names-show"></a></dt>
<dd><p>show sample names? (you can control side and rotation of names with
other ComplexHeatmap::Heatmap arguments)</p></dd>


<dt id="arg-colors">colors<a class="anchor" aria-label="anchor" href="#arg-colors"></a></dt>
<dd><p>output of heat_palette() to set heatmap fill color scheme</p></dd>


<dt id="arg-numbers">numbers<a class="anchor" aria-label="anchor" href="#arg-numbers"></a></dt>
<dd><p>output of heat_numbers() to draw numbers on heatmap cells</p></dd>


<dt id="arg-sample-seriation">sample_seriation<a class="anchor" aria-label="anchor" href="#arg-sample-seriation"></a></dt>
<dd><p>name of method used to order the samples (from seriation::seriate)</p></dd>


<dt id="arg-sample-ser-dist">sample_ser_dist<a class="anchor" aria-label="anchor" href="#arg-sample-ser-dist"></a></dt>
<dd><p>name of distance to use with sample_seriation method (if needed)</p></dd>


<dt id="arg-sample-ser-counts">sample_ser_counts<a class="anchor" aria-label="anchor" href="#arg-sample-ser-counts"></a></dt>
<dd><p>insist on using count data for sample seriation?</p></dd>


<dt id="arg-sample-ser-trans">sample_ser_trans<a class="anchor" aria-label="anchor" href="#arg-sample-ser-trans"></a></dt>
<dd><p>function for transformation of data used for sample seriation
(such as a call to <code><a href="tax_transform.html">tax_transform()</a></code>)</p></dd>


<dt id="arg-tax-seriation">tax_seriation<a class="anchor" aria-label="anchor" href="#arg-tax-seriation"></a></dt>
<dd><p>name of method used to order the taxa (from seriation::seriate)</p></dd>


<dt id="arg-tax-ser-dist">tax_ser_dist<a class="anchor" aria-label="anchor" href="#arg-tax-ser-dist"></a></dt>
<dd><p>name of distance to use with tax_seriation method (if needed)</p></dd>


<dt id="arg-tax-ser-counts">tax_ser_counts<a class="anchor" aria-label="anchor" href="#arg-tax-ser-counts"></a></dt>
<dd><p>insist on using count data for taxa seriation?</p></dd>


<dt id="arg-tax-ser-trans">tax_ser_trans<a class="anchor" aria-label="anchor" href="#arg-tax-ser-trans"></a></dt>
<dd><p>function for transformation of data used for taxa seriation
(such as a call to <code><a href="tax_transform.html">tax_transform()</a></code>)</p></dd>


<dt id="arg-numbers-trans">numbers_trans<a class="anchor" aria-label="anchor" href="#arg-numbers-trans"></a></dt>
<dd><p>name of tax_transform transformation, or a function
for transformation of data used for drawing numbers on cells</p></dd>


<dt id="arg-numbers-zero-replace">numbers_zero_replace<a class="anchor" aria-label="anchor" href="#arg-numbers-zero-replace"></a></dt>
<dd><p>zero replacement method used if named transformation given to number_trans</p></dd>


<dt id="arg-numbers-use-counts">numbers_use_counts<a class="anchor" aria-label="anchor" href="#arg-numbers-use-counts"></a></dt>
<dd><p>insist on using count data for number drawing?
(if TRUE, any numbers_trans transformation would be applied to count data)</p></dd>


<dt id="arg-grid-col">grid_col<a class="anchor" aria-label="anchor" href="#arg-grid-col"></a></dt>
<dd><p>colour of gridlines, or NA for none</p></dd>


<dt id="arg-grid-lwd">grid_lwd<a class="anchor" aria-label="anchor" href="#arg-grid-lwd"></a></dt>
<dd><p>width of gridlines</p></dd>


<dt id="arg-name">name<a class="anchor" aria-label="anchor" href="#arg-name"></a></dt>
<dd><p>used as legend title (colourbar)</p></dd>


<dt id="arg-anno-tax">anno_tax<a class="anchor" aria-label="anchor" href="#arg-anno-tax"></a></dt>
<dd><p>DEPRECATED:
optional annotation of taxa distributions: tax_anno() list output,
or a pre-made ComplexHeatmap HeatmapAnnotation</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="https://rdrr.io/pkg/ComplexHeatmap/man/Heatmap.html" class="external-link">ComplexHeatmap::Heatmap</a></code></p><dl><dt><code>row_dend_side</code></dt>
<dd><p>Should the row dendrogram be put on the left or right of the heatmap?</p></dd>

    <dt><code>row_dend_width</code></dt>
<dd><p>Width of the row dendrogram, should be a <code><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></code> object.</p></dd>

    <dt><code>show_row_dend</code></dt>
<dd><p>Whether show row dendrogram?</p></dd>

    <dt><code>row_dend_gp</code></dt>
<dd><p>Graphic parameters for the dendrogram segments. If users already provide a <code><a href="https://rdrr.io/r/stats/dendrogram.html" class="external-link">dendrogram</a></code> object with edges rendered, this argument will be ignored.</p></dd>

    <dt><code>show_row_names</code></dt>
<dd><p>Whether show row names.</p></dd>

    <dt><code>row_names_gp</code></dt>
<dd><p>Graphic parameters for row names.</p></dd>

    <dt><code>row_names_rot</code></dt>
<dd><p>Rotation of row names.</p></dd>

    <dt><code>row_names_centered</code></dt>
<dd><p>Should row names put centered?</p></dd>


</dl></dd>

</dl></div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="cor_heatmap.html">cor_heatmap()</a></code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Attaching package: ‘dplyr’</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:stats’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     filter, lag</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> The following objects are masked from ‘package:base’:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>     intersect, setdiff, setequal, union</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"dietswap"</span>, package <span class="op">=</span> <span class="st">"microbiome"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># create a couple of numerical variables to use</span></span></span>
<span class="r-in"><span><span class="va">psq</span> <span class="op">&lt;-</span> <span class="va">dietswap</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="ps_mutate.html">ps_mutate</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    weight <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/recode.html" class="external-link">recode</a></span><span class="op">(</span><span class="va">bmi_group</span>, obese <span class="op">=</span> <span class="fl">3</span>, overweight <span class="op">=</span> <span class="fl">2</span>, lean <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    female <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span>, true <span class="op">=</span> <span class="fl">1</span>, false <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    african <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">nationality</span> <span class="op">==</span> <span class="st">"AFR"</span>, true <span class="op">=</span> <span class="fl">1</span>, false <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">psq</span> <span class="op">&lt;-</span> <span class="fu"><a href="tax_filter.html">tax_filter</a></span><span class="op">(</span><span class="va">psq</span>, min_prevalence <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span>, min_sample_abundance <span class="op">=</span> <span class="fl">1</span> <span class="op">/</span> <span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Proportional min_prevalence given: 0.1 --&gt; min 23/222 samples.</span>
<span class="r-in"><span><span class="va">psq</span> <span class="op">&lt;-</span> <span class="fu"><a href="tax_agg.html">tax_agg</a></span><span class="op">(</span><span class="va">psq</span>, <span class="st">"Genus"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># randomly select 20 taxa from the 40 top taxa, and 40 random samples</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="tax_top.html">tax_top</a></span><span class="op">(</span><span class="va">psq</span>, n <span class="op">=</span> <span class="fl">40</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">122</span>, size <span class="op">=</span> <span class="fl">40</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">comp_heatmap</span><span class="op">(</span>data <span class="op">=</span> <span class="va">psq</span>, taxa <span class="op">=</span> <span class="va">taxa</span>, samples <span class="op">=</span> <span class="va">samples</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="comp_heatmap-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># transforming taxon abundances #</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># NOTE: if you plan on transforming taxa (e.g. to compositional data or clr)</span></span></span>
<span class="r-in"><span><span class="co"># but only want to plot a subset of the taxa (e.g. most abundant)</span></span></span>
<span class="r-in"><span><span class="co"># you should NOT subset the original phyloseq before transformation!</span></span></span>
<span class="r-in"><span><span class="co"># Instead, choose the subset of taxa plotted with:</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Note 2, choose a symmetrical palette for clr-transformed data</span></span></span>
<span class="r-in"><span><span class="va">psq</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">comp_heatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    taxa <span class="op">=</span> <span class="va">taxa</span>, samples <span class="op">=</span> <span class="va">samples</span>, colors <span class="op">=</span> <span class="fu"><a href="heat_palette.html">heat_palette</a></span><span class="op">(</span>sym <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-plt img"><img src="comp_heatmap-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Almost all the taxa have high values (&gt;&gt; 0) because they are a highly</span></span></span>
<span class="r-in"><span><span class="co"># abundant subset taken after clr transformation was calculated on all taxa</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># See how just taking the first 30 taxa from the dataset gives more balance</span></span></span>
<span class="r-in"><span><span class="va">psq</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">comp_heatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, samples <span class="op">=</span> <span class="va">samples</span>, colors <span class="op">=</span> <span class="fu"><a href="heat_palette.html">heat_palette</a></span><span class="op">(</span>sym <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-plt img"><img src="comp_heatmap-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># annotating taxa #</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Notes:</span></span></span>
<span class="r-in"><span><span class="co"># - Unlike cor_heatmap, taxa are not annotated by default</span></span></span>
<span class="r-in"><span><span class="co"># - Detection threshold set to 50 as HITchip example data seems to have background noise</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu">comp_heatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">psq</span>, taxa <span class="op">=</span> <span class="va">taxa</span>, samples <span class="op">=</span> <span class="va">samples</span>,</span></span>
<span class="r-in"><span>  tax_anno <span class="op">=</span> <span class="fu"><a href="taxAnnotation.html">taxAnnotation</a></span><span class="op">(</span>Prev <span class="op">=</span> <span class="fu"><a href="anno_tax_prev.html">anno_tax_prev</a></span><span class="op">(</span>undetected <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="comp_heatmap-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># annotating samples #</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">htmp</span> <span class="op">&lt;-</span> <span class="va">psq</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">comp_heatmap</span><span class="op">(</span></span></span>
<span class="r-in"><span>    taxa <span class="op">=</span> <span class="va">taxa</span>, samples <span class="op">=</span> <span class="va">samples</span>, colors <span class="op">=</span> <span class="fu"><a href="heat_palette.html">heat_palette</a></span><span class="op">(</span>sym <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    sample_anno <span class="op">=</span> <span class="fu"><a href="sampleAnnotation.html">sampleAnnotation</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      Nation. <span class="op">=</span> <span class="fu"><a href="anno_sample_cat.html">anno_sample_cat</a></span><span class="op">(</span><span class="st">"nationality"</span>, legend_title <span class="op">=</span> <span class="st">"Nation."</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>coercing non-character anno_cat annotation data to character</span>
<span class="r-in"><span><span class="va">htmp</span></span></span>
<span class="r-plt img"><img src="comp_heatmap-5.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># legends from `anno_sample_cat()` are stored as an attribute of the Heatmap</span></span></span>
<span class="r-in"><span><span class="fu">ComplexHeatmap</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ComplexHeatmap/man/draw-dispatch.html" class="external-link">draw</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  object <span class="op">=</span> <span class="va">htmp</span>,</span></span>
<span class="r-in"><span>  annotation_legend_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">htmp</span>, <span class="st">"AnnoLegends"</span><span class="op">)</span>, merge_legends <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="comp_heatmap-6.png" alt="" width="700" height="433"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by David Barnett.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({


    apiKey: '22e6f0a75b7b1ffae9bf5bc5b58864d7',
    indexName: 'microViz',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script><script data-goatcounter="https://microviz.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script></body></html>

