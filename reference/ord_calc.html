<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ordinate phyloseq object or distance matrix computed by dist_calc — ord_calc • microViz</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Ordinate phyloseq object or distance matrix computed by dist_calc — ord_calc" />
<meta property="og:description" content="Extends functionality of phyloseq::ordinate(). Results can be used directly in ord_plot.
Alternatively you could extract the ordination object for other analyses with ord_get()" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">microViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/articles/microViz.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/Visualising-compositions.html">Visualising-compositions</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/david-barnett/microViz/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Ordinate phyloseq object or distance matrix computed by dist_calc</h1>
    <small class="dont-index">Source: <a href='https://github.com/david-barnett/microViz/blob/master/R/ord_calc.R'><code>R/ord_calc.R</code></a></small>
    <div class="hidden name"><code>ord_calc.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extends functionality of phyloseq::ordinate(). Results can be used directly in ord_plot.
Alternatively you could extract the ordination object for other analyses with ord_get()</p>
    </div>

    <pre class="usage"><span class='fu'>ord_calc</span><span class='op'>(</span>
  <span class='va'>data</span>,
  method <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"auto"</span>, <span class='st'>"PCoA"</span>, <span class='st'>"PCA"</span>, <span class='st'>"CCA"</span>, <span class='st'>"RDA"</span>, <span class='st'>"CAP"</span>, <span class='st'>"NMDS"</span><span class='op'>)</span><span class='op'>[</span><span class='fl'>1</span><span class='op'>]</span>,
  constraints <span class='op'>=</span> <span class='cn'>NULL</span>,
  conditions <span class='op'>=</span> <span class='cn'>NULL</span>,
  scale_cc <span class='op'>=</span> <span class='cn'>TRUE</span>,
  verbose <span class='op'>=</span> <span class='cn'>TRUE</span>,
  <span class='va'>...</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>ps_extra list object: output from dist_calc(), or tax_transform() if no distance calculation required for method e.g. for RDA</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>which ordination method to use? "auto" means automatically determined from ps_extra and other args. If you really know what you want: manually set one of 'PCoA', 'PCA', 'CCA', 'CAP' or 'RDA'</p></td>
    </tr>
    <tr>
      <th>constraints</th>
      <td><p>(a vector of) valid variable name(s) to constrain PCoA or RDA analyses, or leave as 1 for unconstrained ordination</p></td>
    </tr>
    <tr>
      <th>conditions</th>
      <td><p>(a vector of) valid variable name(s) to partial these out of PCoA or RDA analyses with Condition(), or leave as NULL</p></td>
    </tr>
    <tr>
      <th>scale_cc</th>
      <td><p>if TRUE (default) ensures any constraints and conditions vars are scaled before use, to ensure their effects are comparable. If set to FALSE you must ensure you have already set the variables on a similar scale yourself!</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>if TRUE or "max", show any warnings and messages about constraint and conditions scaling and missings etc. FALSE suppresses warnings!</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>optional arguments passed on to phyloseq::ordinate()</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>ps_extra list object</p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='http://dx.plos.org/10.1371/journal.pone.0061217'>phyloseq</a></span><span class='op'>)</span>
<span class='kw'><a href='https://rdrr.io/r/base/library.html'>library</a></span><span class='op'>(</span><span class='va'><a href='https://cran.r-project.org'>vegan</a></span><span class='op'>)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>"dietswap"</span>, package <span class='op'>=</span> <span class='st'>"microbiome"</span><span class='op'>)</span>

<span class='co'># create a couple of numerical variables to use as constraints</span>
<span class='va'>dietswap</span> <span class='op'>&lt;-</span> <span class='fu'><a href='ps_mutate.html'>ps_mutate</a></span><span class='op'>(</span>
  <span class='va'>dietswap</span>,
  female <span class='op'>=</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/if_else.html'>if_else</a></span><span class='op'>(</span><span class='va'>sex</span> <span class='op'>==</span> <span class='st'>"female"</span>, true <span class='op'>=</span> <span class='fl'>1</span>, false <span class='op'>=</span> <span class='fl'>0</span><span class='op'>)</span>,
  weight <span class='op'>=</span> <span class='fu'>dplyr</span><span class='fu'>::</span><span class='fu'><a href='https://dplyr.tidyverse.org/reference/recode.html'>recode</a></span><span class='op'>(</span><span class='va'>bmi_group</span>, obese <span class='op'>=</span> <span class='fl'>3</span>, overweight <span class='op'>=</span> <span class='fl'>2</span>, lean <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
<span class='op'>)</span>

<span class='co'># add a couple of missing values to demo automated dropping of observations with missings</span>
<span class='fu'><a href='https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html'>sample_data</a></span><span class='op'>(</span><span class='va'>dietswap</span><span class='op'>)</span><span class='op'>$</span><span class='va'>female</span><span class='op'>[</span><span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>3</span>, <span class='fl'>4</span><span class='op'>)</span><span class='op'>]</span> <span class='op'>&lt;-</span> <span class='cn'>NA</span>

<span class='co'># compute ordination</span>
<span class='va'>test</span> <span class='op'>&lt;-</span> <span class='va'>dietswap</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='tax_agg.html'>tax_agg</a></span><span class='op'>(</span><span class='st'>"Genus"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='dist_calc.html'>dist_calc</a></span><span class='op'>(</span><span class='st'>"bray"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ord_calc</span><span class='op'>(</span>constraints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"weight"</span>, <span class='st'>"female"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Dropping samples with missings: 2</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Centering (mean) and scaling (sd) the constraint and conditioning vars: </span></div><div class='output co'>#&gt; <span class='message'>	weight</span></div><div class='output co'>#&gt; <span class='message'>	female</span></div><div class='input'><span class='co'># familiarise yourself with the structure of the returned ps_extra list object</span>
<span class='va'>test</span>
</div><div class='output co'>#&gt; ps_extra object - a list with phyloseq and extras:
#&gt; 
#&gt; phyloseq-class experiment-level object
#&gt; otu_table()   OTU Table:         [ 130 taxa and 220 samples ]
#&gt; sample_data() Sample Data:       [ 220 samples by 10 sample variables ]
#&gt; tax_table()   Taxonomy Table:    [ 130 taxa by 3 taxonomic ranks ]
#&gt; 
#&gt; phyloseq info:
#&gt; tax_agg = Genus tax_transform = NA
#&gt; 
#&gt; bray distance matrix of size 220 
#&gt; 0.7639533 0.7699252 0.80507 0.731024 0.7283254 ...
#&gt; 
#&gt; ordination of class: capscale rda cca 
#&gt; capscale(formula = distance ~ weight + female, data = data)
#&gt; constraints: weight+female</div><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/str.html'>str</a></span><span class='op'>(</span><span class='va'>test</span>, max.level <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>
</div><div class='output co'>#&gt; List of 4
#&gt;  $ ps  :Formal class 'phyloseq' [package "phyloseq"] with 5 slots
#&gt;  $ dist: 'dist' num [1:24090] 0.764 0.77 0.805 0.731 0.728 ...
#&gt;   ..- attr(*, "Labels")= chr [1:220] "Sample-1" "Sample-2" "Sample-5" "Sample-6" ...
#&gt;   ..- attr(*, "Size")= int 220
#&gt;   ..- attr(*, "call")= language as.dist.default(m = as.matrix(distMat)[keepers, keepers])
#&gt;   ..- attr(*, "Diag")= logi FALSE
#&gt;   ..- attr(*, "Upper")= logi FALSE
#&gt;  $ ord :List of 13
#&gt;   ..- attr(*, "class")= chr [1:3] "capscale" "rda" "cca"
#&gt;  $ info: 'ps_extra_info' Named chr [1:7] "Genus" NA NA "bray" ...
#&gt;   ..- attr(*, "names")= chr [1:7] "tax_agg" "tax_transform" "tax_scale" "distMethod" ...
#&gt;  - attr(*, "class")= chr [1:2] "ps_extra" "list"</div><div class='input'>
<span class='co'># compute RDA with centre-log-ratio transformed taxa</span>
<span class='va'>test2</span> <span class='op'>&lt;-</span> <span class='va'>dietswap</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='tax_agg.html'>tax_agg</a></span><span class='op'>(</span><span class='st'>"Genus"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='tax_transform.html'>tax_transform</a></span><span class='op'>(</span><span class='st'>"clr"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ord_calc</span><span class='op'>(</span>constraints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"weight"</span>, <span class='st'>"female"</span><span class='op'>)</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Dropping samples with missings: 2</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Centering (mean) and scaling (sd) the constraint and conditioning vars: </span></div><div class='output co'>#&gt; <span class='message'>	weight</span></div><div class='output co'>#&gt; <span class='message'>	female</span></div><div class='input'><span class='co'># plot with oldschool vegan graphics to show it returns a standard interoperable ordination object</span>
<span class='fu'><a href='ps_extra-accessors.html'>ord_get</a></span><span class='op'>(</span><span class='va'>test2</span><span class='op'>)</span> <span class='op'>%&gt;%</span> <span class='fu'>vegan</span><span class='fu'>::</span><span class='fu'><a href='https://rdrr.io/pkg/vegan/man/ordiplot.html'>ordiplot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='img'><img src='ord_calc-1.png' alt='' width='700' height='433' /></div><div class='input'><span class='fu'><a href='ord_plot.html'>ord_plot</a></span><span class='op'>(</span><span class='va'>test2</span>, plot_taxa <span class='op'>=</span> <span class='fl'>8</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>
</div><div class='img'><img src='ord_calc-2.png' alt='' width='700' height='433' /></div><div class='input'><span class='co'># This is equivalent to CAP with "aitchison" distance</span>
<span class='co'># but the latter (below) doesn't allow plotting taxa loadings with ord_plot</span>
<span class='va'>dietswap</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='tax_agg.html'>tax_agg</a></span><span class='op'>(</span><span class='st'>"Genus"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='dist_calc.html'>dist_calc</a></span><span class='op'>(</span><span class='st'>"aitchison"</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'>ord_calc</span><span class='op'>(</span>constraints <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>"weight"</span>, <span class='st'>"female"</span><span class='op'>)</span><span class='op'>)</span> <span class='op'>%&gt;%</span>
  <span class='fu'><a href='ord_plot.html'>ord_plot</a></span><span class='op'>(</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='message'>Dropping samples with missings: 2</span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Centering (mean) and scaling (sd) the constraint and conditioning vars: </span></div><div class='output co'>#&gt; <span class='message'>	weight</span></div><div class='output co'>#&gt; <span class='message'>	female</span></div><div class='img'><img src='ord_calc-3.png' alt='' width='700' height='433' /></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by David Barnett.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


