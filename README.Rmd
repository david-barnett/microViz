---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# microViz

<!-- badges: start -->
<!-- badges: end -->

The goal of microViz is to make wrangling, stats and visualisation of microbiome (16S) sequencing readcount data easier, modular and reproducible.
microViz wraps and extends core microbial ecology packages like phyloseq, vegan, and microbiome.

## Installation

You can install the latest available package version using the following code.

``` r
# install.packages("devtools")
devtools::install_github("MUMC-MEDMIC/microViz@bbecb5d33dc0b6f987d31a788105a3dbc61cfab5")
# ensure you have the commit you want (e.g. check the hash after the @ is the latest)
# eventually I will set up a proper version system once I've added more of the in-development functions
```
## Setup

```{r load, message=FALSE, warning=FALSE}
library(microViz)
library(phyloseq)
library(vegan)
library(microbiome)
library(dplyr)
```

```{r data setup}
# get some example data
data("dietswap", package = "microbiome")

# create a couple of numerical variables to use as constraints or conditions
sample_data(dietswap)$weight <-
  recode(sample_data(dietswap)$bmi_group, obese = 3, overweight = 2, lean = 1)
# add a couple of missing values to demo automated dropping of observations with missings
sample_data(dietswap)$female <-
  if_else(sample_data(dietswap)$sex == "female", true = 1, false = 0)
sample_data(dietswap)$female[c(3, 4)] <- NA
```


## Example: ordination plot workflow

You want to visually see if overall microbial ecosystem composition differs markedly between groups, e.g. BMI.

Here is one option to try first:

1. Aggregate the taxa into bacterial families (for example) - use `tax_agg()`
2. Transform the microbial data with the centre-log-ratio transformation - use `tax_transform()`
3. Perform PCA with the clr-transformed features (equivalent to aitchison distance PCoA) - use `ordin8()`
4. Plot the first 2 axes of this PCA ordination, colouring samples by group and adding taxon loading arrows to visualise which taxa generally differ across your samples - use `plot_ordin8()`
5. Customise the theme of the ggplot as you like and/or add features like ellipses or annotations

```{r ordination-plot, dpi=300}
unconstrained_aitchison_pca <- 
  dietswap %>%
  tax_agg("Family") %>%
  tax_transform('clr') %>%
  ordin8(method = 'RDA')

unconstrained_aitchison_pca %>%
  plot_ordin8(plot_taxa = 1:5, colour = 'bmi_group', auto_title = TRUE) +
  stat_ellipse(aes(linetype = bmi_group, colour = bmi_group)) + 
  scale_colour_brewer(palette = 'Set1')
```

# Session info
```{r}
options(width = 100)
devtools::session_info()
```

