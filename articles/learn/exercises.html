<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Learn microbiome analysis with microViz • microViz</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><!-- docsearch --><script src="../../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Learn microbiome analysis with microViz">
<meta property="og:description" content="microViz">
<meta property="og:image" content="https://david-barnett.github.io/microViz/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-2YQ669S4V5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2YQ669S4V5');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">microViz</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.9.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/web-only/phyloseq.html">Working with phyloseq objects</a>
    </li>
    <li>
      <a href="../../articles/web-only/tax-fixing.html">Fixing your tax_table</a>
    </li>
    <li>
      <a href="../../articles/web-only/ordination.html">Ordination plots</a>
    </li>
    <li>
      <a href="../../articles/web-only/ordination-interactive.html">Interactive ordination plots</a>
    </li>
    <li>
      <a href="../../articles/web-only/compositions.html">Visualising compositions with barplots</a>
    </li>
    <li>
      <a href="../../articles/web-only/heatmaps.html">Heatmaps of microbiome composition or correlation</a>
    </li>
    <li>
      <a href="../../articles/web-only/modelling-taxa.html">Statistical modelling of individual taxa</a>
    </li>
    <li>
      <a href="../../articles/web-only/videos.html">Tutorial video</a>
    </li>
    <li>
      <a href="../../articles/web-only/atlas1006.html">Example analyses with atlas1006 data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../articles/learn/exercises.html">Learn</a>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
<li class="dropdown-header">
      </li>
</ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/david-barnett/microViz/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Learn microbiome analysis with microViz</h1>
                        <h4 data-toc-skip class="author">David Barnett</h4>
            
            <h4 data-toc-skip class="date">31st May 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/david-barnett/microViz/blob/HEAD/vignettes/learn/exercises.Rmd" class="external-link"><code>vignettes/learn/exercises.Rmd</code></a></small>
      <div class="hidden name"><code>exercises.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="section level4">
<h4 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h4>
<p>These exercises will cover some of the core concepts in microbiome data analysis, using example data. You can follow along by writing code in your own R Markdown notebook (or script).</p>
<ul>
<li><p><a href="#intro-diversity"><strong>Part 1</strong></a> will introduce you to: phyloseq objects for microbiome data; basic bar charts for visualizing microbiome compositions; and alpha diversity indices.</p></li>
<li><p><a href="#dissimilarity-ordination-filtering"><strong>Part 2</strong></a> will introduce you to: ecological distances and dissimilarity measures; the use of PCoA plots and PERMANOVA; and how/why/when to filter your microbiome data (taxa/samples).</p></li>
<li><p><a href="#transformations-pca-da"><strong>Part 3</strong></a> will introduce you to: the Euclidean distance; log and CLR transformations; heatmaps for microbiome abundance data; Principal Components Analysis (PCA); and Differential Abundance (DA) testing methods.</p></li>
</ul>
</div>
<div class="section level4">
<h4 id="further-resources">Further resources<a class="anchor" aria-label="anchor" href="#further-resources"></a>
</h4>
<p>Refer to the <a href="https://david-barnett.github.io/microViz/">microViz website</a> to see help pages for every function, as well as further tutorials.</p>
<p>The first version of this material was developed as part of the 2022 Evomics workshop on Genomics.</p>
<p>Some accompanying slides are available via the Evomics workshop’s website: <a href="http://evomics.org/2022-workshop-on-genomics-cesky-krumlov/" class="external-link uri">http://evomics.org/2022-workshop-on-genomics-cesky-krumlov/</a></p>
</div>
<div class="section level4">
<h4 id="using-your-own-data">Using your own data?<a class="anchor" aria-label="anchor" href="#using-your-own-data"></a>
</h4>
<p>To apply these methods to your own data, you will first need to create a phyloseq object containing your data. You can process your sequencing data into a count table or biom file using e.g. DADA2 for 16S rRNA gene amplicon sequencing data, or e.g. MetaPhlAn3 for shotgun metagenomic data. Then see the article called <a href="https://david-barnett.github.io/microViz/articles/web-only/phyloseq.html">“Working with phyloseq objects”</a> for more details on creating phyloseq objects.</p>
</div>
<div class="section level4">
<h4 id="comments-or-questions">Comments or questions?<a class="anchor" aria-label="anchor" href="#comments-or-questions"></a>
</h4>
<p>Something missing or unclear? Spotted a mistake? Let me know on the microViz <a href="https://github.com/david-barnett/microViz/discussions" class="external-link">GitHub discussions page</a>.</p>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>Set R Markdown chunk output options:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/knitr/man/opts_chunk.html" class="external-link">opts_chunk</a></span><span class="op">$</span><span class="fu">set</span><span class="op">(</span>echo <span class="op">=</span> <span class="cn">TRUE</span>, fig.width <span class="op">=</span> <span class="fl">6</span>, fig.height <span class="op">=</span> <span class="fl">4</span>, dpi <span class="op">=</span> <span class="fl">120</span><span class="op">)</span></span></code></pre></div>
<p>Load the R packages we will be using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mhahsler/seriation" class="external-link">seriation</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://dx.plos.org/10.1371/journal.pone.0061217" class="external-link">phyloseq</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://david-barnett.github.io/microViz">microViz</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://shiny.rstudio.com/" class="external-link">shiny</a></span><span class="op">)</span></span></code></pre></div>
<p>Get the two example datasets:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html" class="external-link">url</a></span><span class="op">(</span><span class="st">"https://github.com/david-barnett/evomics-material/raw/898766166ce151f837b8d668bdc0bf0f859a6dd3/data/mice.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"shao19"</span>, package <span class="op">=</span> <span class="st">"microViz"</span><span class="op">)</span></span></code></pre></div>
<p>We’ll primarily use these two datasets in these exercises, both are data on the gut microbiome. The first is from a study of antibiotic administration in mice, and the second is from a large birth cohort study in human infants.</p>
<p>Each dataset was generated using different sequencing techniques, and different sequence data processing approaches. But the analysis approaches we will learn in these exercises can be readily applied to both methods. The approaches are also appropriate for microbiome data from other environments, not just gut microbiota!</p>
<ul>
<li>
<code>mice</code> is 16S rRNA gene amplicon sequencing data, from the mouse antibiotics study
<ul>
<li>They used Illumina MiSeq and processed the data into ASVs using DADA2</li>
</ul>
</li>
<li>
<code>shao19</code> is shotgun metagenomic data, from a 2019 study of infants born vaginally or by C-section.
<ul>
<li>They used Illumina HiSeq and the abundance of species-like features was inferred with metaphlan3.</li>
</ul>
<!-- (note: not metaphlan3 in the original paper, but available from curatedMetagenomicData package/project) -->
</li>
</ul>
<p>So the data has already been processed from fastq files into counts per taxon. This is the exciting bit, you get to explore and visualize the data, and do statistics (yay!).</p>
<hr>
</div>
<div class="section level2">
<h2 id="intro-diversity">1: Intro &amp; Diversity<a class="anchor" aria-label="anchor" href="#intro-diversity"></a>
</h2>
<p>This section will introduce you to: phyloseq objects for microbiome data; basic bar charts for visualizing microbiome compositions; and alpha diversity indices.</p>
<hr>
<div class="section level3">
<h3 id="intro-to-phyloseq">Intro to phyloseq<a class="anchor" aria-label="anchor" href="#intro-to-phyloseq"></a>
</h3>
<p>This is a <code>phyloseq</code> S4 object, containing processed microbiota data from the mouse study.</p>
<details><summary><p><strong>Click here for more details about the mice dataset:</strong></p>
</summary><p><strong>The mice data</strong></p>
<p>The data originate from a study on the effects of oral antibiotic administration on flavivirus infection (<a href="https://www.ncbi.nlm.nih.gov/pubmed/29590614" class="external-link uri">https://www.ncbi.nlm.nih.gov/pubmed/29590614</a>). Sequence data was generated from extracted nucleic acid from stool samples collected from individually caged mice and amplified using primers specific for the V4 region using primers 515F/806R.</p>
<p>The study followed flavivirus infection after the following treatments:</p>
<ol style="list-style-type: decimal">
<li>Koolaid: Antibiotics are provided to the mice via their drinking water. As many of the antibiotics taste bad, koolaid is added as a sweetener. Therefore, the appropriate control is water spiked and labelled <em>koolaid</em>.</li>
<li>Ampicillin (Amp): <a href="https://en.wikipedia.org/wiki/Ampicillin" class="external-link uri">https://en.wikipedia.org/wiki/Ampicillin</a>
</li>
<li>Metronidazole (Met): <a href="https://en.wikipedia.org/wiki/Metronidazole" class="external-link uri">https://en.wikipedia.org/wiki/Metronidazole</a>
</li>
<li>Ampicillin + Metronidazole (Amp+Metro)</li>
</ol>
<p>Treatments were supplied ad libitum for 2 weeks prior to viral infection and maintained for 2 weeks post-infection. Primary outcome was mouse survival. Each treatment group had two subgroups of mice that were either a) left uninfected as controls or b) infected with West Nile Virus via a subcutaneous foot pad injection.</p>
</details><p>Get a little familiar with the object. What does it have in it? Can you look at each part?</p>
<p>The printed object shows you functions you can use to access the data inside.</p>
<p>You can also use the <code>@</code> symbol.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 3229 taxa and 520 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 520 samples by 11 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 3229 taxa by 7 taxonomic ranks ]</span></span></code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># View(mice)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html" class="external-link">tax_table</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Taxonomy Table:     [6 taxa by 7 taxonomic ranks]:</span></span>
<span><span class="co">##         Kingdom    Phylum           Class                 Order            </span></span>
<span><span class="co">## ASV0001 "Bacteria" "Bacteroidetes"  "Bacteroidia"         "Bacteroidales"  </span></span>
<span><span class="co">## ASV0002 "Bacteria" "Proteobacteria" "Gammaproteobacteria" "Xanthomonadales"</span></span>
<span><span class="co">## ASV0003 "Bacteria" "Bacteroidetes"  "Bacteroidia"         "Bacteroidales"  </span></span>
<span><span class="co">## ASV0004 "Bacteria" "Bacteroidetes"  "Bacteroidia"         "Bacteroidales"  </span></span>
<span><span class="co">## ASV0005 "Bacteria" "Bacteroidetes"  "Bacteroidia"         "Bacteroidales"  </span></span>
<span><span class="co">## ASV0006 "Bacteria" "Bacteroidetes"  "Bacteroidia"         "Bacteroidales"  </span></span>
<span><span class="co">##         Family               Genus              Species      </span></span>
<span><span class="co">## ASV0001 "Porphyromonadaceae" NA                 NA           </span></span>
<span><span class="co">## ASV0002 "Xanthomonadaceae"   "Stenotrophomonas" "maltophilia"</span></span>
<span><span class="co">## ASV0003 "Porphyromonadaceae" NA                 NA           </span></span>
<span><span class="co">## ASV0004 "Porphyromonadaceae" NA                 NA           </span></span>
<span><span class="co">## ASV0005 "Porphyromonadaceae" NA                 NA           </span></span>
<span><span class="co">## ASV0006 "Porphyromonadaceae" NA                 NA</span></span></code></pre>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/rank_names.html" class="external-link">rank_names</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Kingdom" "Phylum"  "Class"   "Order"   "Family"  "Genus"   "Species"</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/otu_table-methods.html" class="external-link">otu_table</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> </span></code></pre></div>
<pre><code><span><span class="co">## OTU Table:          [8 taxa and 15 samples]</span></span>
<span><span class="co">##                      taxa are columns</span></span>
<span><span class="co">##        ASV0001 ASV0002 ASV0003 ASV0004 ASV0005 ASV0006 ASV0007 ASV0008</span></span>
<span><span class="co">## D14.A1    3343       0    4205    3470    3607    1210    1159    1852</span></span>
<span><span class="co">## D14.B5    4332       0    5412    2494    3083    1451    1663    1745</span></span>
<span><span class="co">## D0.D5     5344       0    3906    1439    2396    1402    1217    2078</span></span>
<span><span class="co">## D0.E1     2994       0    4005    2188    2882    1267    1821    1788</span></span>
<span><span class="co">## D0.E2     2315       0    3987     955    1665    1025     899    1342</span></span>
<span><span class="co">## D0.E3     1972       0    4336    1876    3422    1208     551    1900</span></span>
<span><span class="co">## D0.E4     2352       0    2561    1960    2060    1350    1095    1200</span></span>
<span><span class="co">## D0.E5     1386       0    1752    1471    1363     724    1050     871</span></span>
<span><span class="co">## D0.F1     3795       0    4052    2226    3130     539     162     247</span></span>
<span><span class="co">## D0.F2     2867       0    2063     435    1412     410       0     150</span></span>
<span><span class="co">## D0.F3     3850       0    4203     508    2839     533       0     230</span></span>
<span><span class="co">## D0.F4     6740       0    5045    1356    5755     517      85     210</span></span>
<span><span class="co">## D14.C1    2664       3    2892    1530    2176     735    1508    1577</span></span>
<span><span class="co">## D0.F5     5303       3    4203    3313    4471    1241     344     441</span></span>
<span><span class="co">## D0.G1     3052       0    3393    3209    2867     873     372    1512</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mice@otu_table[1:15, 1:10] # the same result</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_variables.html" class="external-link">sample_variables</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "sample_id"       "barcode"         "run"             "plate"          </span></span>
<span><span class="co">##  [5] "sample"          "sex"             "cage"            "treatment_days" </span></span>
<span><span class="co">##  [9] "treatment"       "virus"           "survival_status"</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_data-methods.html" class="external-link">sample_data</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">15</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##                 sample_id      barcode run plate sample</span></span>
<span><span class="co">## D14.A1  1.Thackray.D14.A1 ACGAGACTGATT 368     1      1</span></span>
<span><span class="co">## D14.B5 10.Thackray.D14.B5 ACCGGTATGTAC 368     1     10</span></span>
<span><span class="co">## D0.D5  100.Thackray.D0.D5 ATCTACCGAAGC 368     2    100</span></span>
<span><span class="co">## D0.E1  101.Thackray.D0.E1 ACTTGGTGTAAG 368     2    101</span></span>
<span><span class="co">## D0.E2  102.Thackray.D0.E2 TCTTGGAGGTCA 368     2    102</span></span>
<span><span class="co">## D0.E3  103.Thackray.D0.E3 TCACCTCCTTGT 368     2    103</span></span>
<span><span class="co">## D0.E4  104.Thackray.D0.E4 GCACACCTGATA 368     2    104</span></span>
<span><span class="co">## D0.E5  105.Thackray.D0.E5 GCGACAATTACA 368     2    105</span></span>
<span><span class="co">## D0.F1  106.Thackray.D0.F1 TCATGCTCCATT 368     2    106</span></span>
<span><span class="co">## D0.F2  107.Thackray.D0.F2 AGCTGTCAAGCT 368     2    107</span></span>
<span><span class="co">## D0.F3  108.Thackray.D0.F3 GAGAGCAACAGA 368     2    108</span></span>
<span><span class="co">## D0.F4  109.Thackray.D0.F4 TACTCGGGAACT 368     2    109</span></span>
<span><span class="co">## D14.C1 11.Thackray.D14.C1 AATTGTGTCGGA 368     1     11</span></span>
<span><span class="co">## D0.F5  110.Thackray.D0.F5 CGTGCTTAGGCT 368     2    110</span></span>
<span><span class="co">## D0.G1  111.Thackray.D0.G1 TACCGAAGGTAT 368     2    111</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_names-methods.html" class="external-link">sample_names</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##  [1] "D14.A1" "D14.B5" "D0.D5"  "D0.E1"  "D0.E2"  "D0.E3"  "D0.E4"  "D0.E5" </span></span>
<span><span class="co">##  [9] "D0.F1"  "D0.F2"</span></span></code></pre>
<hr>
</div>
<div class="section level3">
<h3 id="looking-at-microbiome-data">Looking at microbiome data<a class="anchor" aria-label="anchor" href="#looking-at-microbiome-data"></a>
</h3>
<p>Okay, so how do we look at the microbiota abundance data? To do this, we’re going to use the R package <code>microViz</code></p>
<div class="section level4">
<h4 id="barcharts-bad-to-better">Barcharts: bad to better<a class="anchor" aria-label="anchor" href="#barcharts-bad-to-better"></a>
</h4>
<p>Lets take a very small subset of this data to get started. Just the control group (vehicle treatment) at day 13.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We can filter the samples like this, using the sample_data information</span></span>
<span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 563 taxa and 10 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 10 samples by 11 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 563 taxa by 7 taxonomic ranks ]</span></span></code></pre>
<p>We will start by naively plotting the raw data, and then make several improvements to make the bar chart more informative.</p>
<div class="section level5">
<h5 id="bad-bars">Bad bars<a class="anchor" aria-label="anchor" href="#bad-bars"></a>
</h5>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">'unique'</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    sample_order <span class="op">=</span> <span class="st">'asis'</span>, tax_transform_for_plot <span class="op">=</span> <span class="st">'identity'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## NAs detected in phyloseq tax_table:</span></span>
<span><span class="co">## Consider using tax_fix() to make taxa uniquely identifiable</span></span>
<span><span class="co">## NAs detected in phyloseq tax_table:</span></span>
<span><span class="co">## Consider using tax_fix() to make taxa uniquely identifiable</span></span></code></pre>
<p><img src="exercises_files/figure-html/unnamed-chunk-11-1.png" width="720"></p>
<p>What is going on here? The unique taxa have uninformative IDs, and we also got a message about problems with the taxonomy table.</p>
<p>The total number of reads also varies a lot between samples! The total number of reads for each sample is NOT a reliable indicator of the biomass or bacterial load of each sample. So for now we will just consider the relative abundance of each taxon, as proportions of the total counts for that sample.</p>
</div>
<div class="section level5">
<h5 id="compositions">Compositions (%)<a class="anchor" aria-label="anchor" href="#compositions"></a>
</h5>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">'unique'</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, sample_order <span class="op">=</span> <span class="st">'asis'</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## NAs detected in phyloseq tax_table:</span></span>
<span><span class="co">## Consider using tax_fix() to make taxa uniquely identifiable</span></span>
<span><span class="co">## NAs detected in phyloseq tax_table:</span></span>
<span><span class="co">## Consider using tax_fix() to make taxa uniquely identifiable</span></span></code></pre>
<p><img src="exercises_files/figure-html/unnamed-chunk-12-1.png" width="720"></p>
</div>
<div class="section level5">
<h5 id="fixing-the-tax_table">Fixing the tax_table<a class="anchor" aria-label="anchor" href="#fixing-the-tax_table"></a>
</h5>
<p>Let’s look at the taxonomy table interactively:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tax_fix_interactive(mice) # run this in the R Console for an interactive look</span></span></code></pre></div>
<p>Looks like we just need to fill in some blank cells when a sequence was not classified at genus or family. <code>tax_fix</code> can do this, it just copies down info from a higher rank classification. Let’s update our <code>mice</code> phyloseq object with this fix.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/tax_fix.html">tax_fix</a></span><span class="op">(</span><span class="va">mice</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>We can also rename the unique taxa with a more informative name, according to their classification at the rank of Family (and how common they are).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/taxa_names-methods.html" class="external-link">taxa_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="va">head</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ASV0001" "ASV0002" "ASV0003" "ASV0004" "ASV0005" "ASV0006"</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/tax_rename.html">tax_rename</a></span><span class="op">(</span><span class="va">mice</span>, rank <span class="op">=</span> <span class="st">'Family'</span><span class="op">)</span></span>
<span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/taxa_names-methods.html" class="external-link">taxa_names</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="va">head</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Porphyromonadaceae 001" "Xanthomonadaceae 01"    "Porphyromonadaceae 002"</span></span>
<span><span class="co">## [4] "Porphyromonadaceae 003" "Porphyromonadaceae 004" "Porphyromonadaceae 005"</span></span></code></pre>
<p>Let’s try again with the better names.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">'unique'</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, sample_order <span class="op">=</span> <span class="st">'asis'</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-16-1.png" width="720"></p>
<p>Sadly we don’t have enough distinct colours to show all the unique taxa.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">'unique'</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, sample_order <span class="op">=</span> <span class="st">'asis'</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    merge_other <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-17-1.png" width="720"></p>
</div>
<div class="section level5">
<h5 id="aggregating-taxa">Aggregating taxa<a class="anchor" aria-label="anchor" href="#aggregating-taxa"></a>
</h5>
<p>So let’s “aggregate” all the counts into family-level groups. For each family, this adds together all the counts from every ASV that belongs to that family. We can do that by changing the <code>tax_level</code> argument to “Family”.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"Family"</span>, n_taxa <span class="op">=</span> <span class="fl">10</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>, sample_order <span class="op">=</span> <span class="st">'asis'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-18-1.png" width="720"></p>
<p>By aggregating at family level, we have sacrificed taxonomic resolution, compared to using ASVs. But this way we can get an idea of which families are the most abundant, and how variable the communities are.</p>
<p>Try making some similar plots aggregated at different taxonomic ranks.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rank_names(mice)</span></span>
<span><span class="co"># mice %&gt;%</span></span>
<span><span class="co">#   ps_filter(treatment_days == 'D13', virus == 'WNV2000', treatment == 'Vehicle') %&gt;%</span></span>
<span><span class="co">#   comp_barplot(tax_level = , n_taxa = 10, sample_order = 'asis', merge_other = FALSE)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"Genus"</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    sample_order <span class="op">=</span> <span class="st">'asis'</span>, merge_other <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-20-1.png" width="720"></p>
<p>Many of the ASVs in this mice data, the <em>Porphyromonadaceae</em>, could not be classified at genus level.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"Phylum"</span>, n_taxa <span class="op">=</span> <span class="fl">7</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>, sample_order <span class="op">=</span> <span class="st">'asis'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-21-1.png" width="720"></p>
</div>
<div class="section level5">
<h5 id="fickle-phyla">Fickle Phyla<a class="anchor" aria-label="anchor" href="#fickle-phyla"></a>
</h5>
<p>A note on phylum names! There have been major changes this year and some of these are now old names. Most published research is of course with the old names (and still probably will be for a year or so).</p>
<hr>
</div>
</div>
</div>
<div class="section level3">
<h3 id="fun-with-barcharts">Fun with barcharts<a class="anchor" aria-label="anchor" href="#fun-with-barcharts"></a>
</h3>
<p>More examples/tutorial of visualizing microbiome data using stacked barcharts can be found here: <a href="https://david-barnett.github.io/microViz/articles/web-only/compositions.html" class="uri">https://david-barnett.github.io/microViz/articles/web-only/compositions.html</a></p>
<p>Try it out for yourself a bit!</p>
<p>Bar charts often look better when you sort the samples by similarity. The webpage mentions using Bray-Curtis distances and hierarchical clustering to sort samples. We haven’t discussed dissimilarity or distances yet, but we will in the next set of exercises!</p>
<p>For now, just appreciate that it can make the bar charts easier to read!</p>
<hr>
</div>
<div class="section level3">
<h3 id="alpha-diversity">Alpha diversity<a class="anchor" aria-label="anchor" href="#alpha-diversity"></a>
</h3>
<p>How diverse is the bacterial microbiome of each sample?</p>
<div class="section level4">
<h4 id="why-is-this-interesting">Why is this interesting?<a class="anchor" aria-label="anchor" href="#why-is-this-interesting"></a>
</h4>
<div class="section level5">
<h5 id="biologically">Biologically<a class="anchor" aria-label="anchor" href="#biologically"></a>
</h5>
<ul>
<li>Lower gut microbiome diversity is related to worse health in adult humans.</li>
<li>Higher diversity ecosystems are often considered healthier, more mature, and more resilient to perturbation.</li>
<li>BUT: diverse == healthy does not hold for all ecosystems, e.g. early infant gut microbiome, so consider your own data and hypotheses carefully.</li>
</ul>
</div>
<div class="section level5">
<h5 id="practically">Practically<a class="anchor" aria-label="anchor" href="#practically"></a>
</h5>
<p>Diversity indices provide a simple one number summary of each ecosystem: easy to compare and do stats with.</p>
</div>
</div>
<div class="section level4">
<h4 id="richness">Richness<a class="anchor" aria-label="anchor" href="#richness"></a>
</h4>
<p>The more the merrier. The simplest measure is just counting, aka “Observed Richness”. Let’s compute the observed richness and label each sample with it.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_richness.html">ps_calc_richness</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'observed'</span>, varname <span class="op">=</span> <span class="st">'N genera'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"Genus"</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, label <span class="op">=</span> <span class="st">'N genera'</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    sample_order <span class="op">=</span> <span class="st">'asis'</span>, merge_other <span class="op">=</span> <span class="cn">FALSE</span><span class="co">#, tax_transform_for_plot = 'identity'</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-23-1.png" width="720"></p>
</div>
<div class="section level4">
<h4 id="diversity">Diversity<a class="anchor" aria-label="anchor" href="#diversity"></a>
</h4>
<p>Richness and evenness matter in the calculation of true diversity indices.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_diversity.html">ps_calc_diversity</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'shannon'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_mutate.html">ps_mutate</a></span><span class="op">(</span>shannon_Genus <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">shannon_Genus</span>, digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"Genus"</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, label <span class="op">=</span> <span class="st">'shannon_Genus'</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    sample_order <span class="op">=</span> <span class="st">'asis'</span>, merge_other <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-24-1.png" width="720"></p>
</div>
<div class="section level4">
<h4 id="statistics-with-alpha-diversity">Statistics with alpha diversity<a class="anchor" aria-label="anchor" href="#statistics-with-alpha-diversity"></a>
</h4>
<p>So we have our alpha diversity values for this small subset of mice.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Vehicle'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_diversity.html">ps_calc_diversity</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'shannon'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">shannon_Genus</span>, y <span class="op">=</span> <span class="st">"Day 13\ncontrols"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Shannon diversity (Genus)'</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html" class="external-link">xlim</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-25-1.png" width="360"></p>
<p>Let’s calculate alpha diversity for all mice after antibiotic or control treatment, and make a comparison. I suspect that the average gut microbiota diversity of the antibiotic exposed mice will differ from the control group’s at day 3.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First compute a new variable aggregating all the control mice together</span></span>
<span><span class="va">mice</span> <span class="op">&lt;-</span> <span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_mutate.html">ps_mutate</a></span><span class="op">(</span>antibiotics <span class="op">=</span> <span class="va">treatment</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Amp"</span>, <span class="st">"Metro"</span>, <span class="st">"AmpMetro"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_diversity.html">ps_calc_diversity</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'shannon'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>y <span class="op">=</span> <span class="va">antibiotics</span>, x <span class="op">=</span> <span class="va">shannon_Genus</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>position <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/position_jitter.html" class="external-link">position_jitter</a></span><span class="op">(</span>height <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-27-1.png" width="480"></p>
<p>It looks like the antibiotics treated mice have lower gut microbiota diversity on average. A simple statistical test supports this.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_diversity.html">ps_calc_diversity</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'shannon'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/wilcox.test.html" class="external-link">wilcox.test</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">shannon_Genus</span> <span class="op">~</span> <span class="va">antibiotics</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Wilcoxon rank sum test with continuity correction</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## data:  shannon_Genus by antibiotics</span></span>
<span><span class="co">## W = 533, p-value = 0.0142</span></span>
<span><span class="co">## alternative hypothesis: true location shift is not equal to 0</span></span></code></pre>
<p>You can apply more complex statistical tests as you like, e.g. adjusting for covariates with linear regression, using <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_diversity.html">ps_calc_diversity</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'shannon'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">shannon_Genus</span> <span class="op">~</span> <span class="va">antibiotics</span> <span class="op">+</span> <span class="va">virus</span>, data <span class="op">=</span> <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## lm(formula = shannon_Genus ~ antibiotics + virus, data = .)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##      Min       1Q   Median       3Q      Max </span></span>
<span><span class="co">## -1.34105 -0.20830  0.08928  0.48767  1.25856 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                 Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)       1.5947     0.2036   7.831 7.76e-11 ***</span></span>
<span><span class="co">## antibioticsTRUE  -0.5445     0.1908  -2.854  0.00587 ** </span></span>
<span><span class="co">## virusWNV2000      0.3217     0.1742   1.847  0.06956 .  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 0.6479 on 62 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.1535, Adjusted R-squared:  0.1262 </span></span>
<span><span class="co">## F-statistic: 5.622 on 2 and 62 DF,  p-value: 0.005706</span></span></code></pre>
<p>Try it out for yourself at other time points? Practice making plots and doing simple statistical tests.</p>
<p>What about richness?</p>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="extension-exercises-for-part-1">Extension exercises for part 1<a class="anchor" aria-label="anchor" href="#extension-exercises-for-part-1"></a>
</h3>
<details><summary><p><strong>Click here for an extension activity with an IBD dataset:</strong></p>
</summary><p>This is an extension exercise, for those who are moving quickly.</p>
<p><strong>Inflammatory Bowel Disease study</strong></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ibd</span> <span class="op">&lt;-</span> <span class="fu">corncob</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/corncob/man/ibd_phylo.html" class="external-link">ibd_phylo</a></span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/tax_mutate.html">tax_mutate</a></span><span class="op">(</span>Species <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="co"># ibd_phylo Species column was blank -&gt; deleted</span></span>
<span>  <span class="fu"><a href="../../reference/ps_mutate.html">ps_mutate</a></span><span class="op">(</span>disease <span class="op">=</span> <span class="va">ibd</span> <span class="op">==</span> <span class="st">'ibd'</span>, ibd <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="co"># adds disease state indicator variable</span></span></code></pre></div>
<p><code>ibd</code> is another phyloseq object containing 16S rRNA gene amplicon sequencing data, from a 2012 study of Inflammatory Bowel Disease in children and young adults.</p>
<p>It’s “old” data: they used 454 Pyrosequencing, and clustered the raw sequences into “OTUs”.</p>
<p>Have a look at the data, like we did before for the <code>mice</code> dataset.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ibd</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 36349 taxa and 91 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 91 samples by 15 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 36349 taxa by 6 taxonomic ranks ]</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span></code></pre></div>
<p>You can perform alpha diversity analysis: Try comparing the alpha diversity of the IBD patients against the healthy controls.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span></code></pre></div>
<p>You can also try this stuff out on the Shao 2019 Birth cohort data. Don’t worry if you don’t try this now, as we will look at Shao 2019 dataset in the next part of the lab.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao19</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 819 taxa and 1644 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 1644 samples by 11 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 819 taxa by 6 taxonomic ranks ]</span></span>
<span><span class="co">## phy_tree()    Phylogenetic Tree: [ 819 tips and 818 internal nodes ]</span></span></code></pre>
</details><details><summary><p><strong>Click here for additional notes on richness and readcount</strong></p>
</summary><p><strong>Additional notes on richness and readcount</strong></p>
<p>Simple approaches like Observed Richness are sensitive to what ecologists call “sampling effort”. For macroecologists, this is actually how much time/effort you spent trying to count all the organisms present in an ecosystem. In our case, the amount of total reads obtained represents the sampling effort: more reads, more effort. Indeed we can see that the samples with a much lower readcount have lower observed richness.</p>
<p>(Furthermore, as this richness estimate is based on a sample, and not the actual ecosystem, the richness estimate actually has quantifiable uncertainty too.)</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">treatment_days</span> <span class="op">==</span> <span class="st">'D13'</span>, <span class="va">virus</span> <span class="op">==</span> <span class="st">'WNV2000'</span>, <span class="va">treatment</span> <span class="op">==</span> <span class="st">'Amp'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_calc_richness.html">ps_calc_richness</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'observed'</span>, varname <span class="op">=</span> <span class="st">'N genera'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"Genus"</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, label <span class="op">=</span> <span class="st">'N genera'</span>, bar_width <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>    sample_order <span class="op">=</span> <span class="st">'asis'</span>, merge_other <span class="op">=</span> <span class="cn">FALSE</span>, tax_transform_for_plot <span class="op">=</span> <span class="st">'identity'</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-35-1.png" width="720"></p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mice</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_calc_richness.html">ps_calc_richness</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">'Genus'</span>, index <span class="op">=</span> <span class="st">'observed'</span>, varname <span class="op">=</span> <span class="st">'genera'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_mutate.html">ps_mutate</a></span><span class="op">(</span>readcount <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_sums.html" class="external-link">sample_sums</a></span><span class="op">(</span><span class="va">mice</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">readcount</span>, <span class="va">genera</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.4</span>, size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="fl">14</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-36-1.png" width="600"></p>
<p><strong>What to do:</strong></p>
<ol style="list-style-type: decimal">
<li>
<strong>Simple solution</strong>: Ignore the problem. Whilst you can’t interpret the richness of any individual sample as being correct, it is still usually valid to compare richness across groups of samples, as the readcount variation is only random noise, and should be uncorrelated with your grouping variable (but do check this).</li>
<li>
<strong>Harder solution</strong>: Explore more rigorous methods like <code>breakaway</code> by Amy Willis and team. <a href="https://www.frontiersin.org/articles/10.3389/fmicb.2019.02407/full" class="external-link uri">https://www.frontiersin.org/articles/10.3389/fmicb.2019.02407/full</a>
</li>
</ol></details><hr>
</div>
</div>
<div class="section level2">
<h2 id="dissimilarity-ordination-filtering">2: Dissimilarity, ordination, &amp; filtering<a class="anchor" aria-label="anchor" href="#dissimilarity-ordination-filtering"></a>
</h2>
<p>This section will introduce you to ecological distances and dissimilarity measures; the use of PCoA plots and PERMANOVA; and how/why/when to filter your microbiome data (taxa/samples).</p>
<hr>
<p>Part 1 was relatively straightforward, at least conceptually. But there is a lot more interesting stuff we can do with microbiome data.</p>
<p>We’ve looked at one sample at a time and calculated and compared simple summary measures of sample alpha-diversity.</p>
<p>Alpha diversity is sometimes referred to as “within sample” diversity.</p>
<p>Now we’re going to look at “beta diversity”, or “between sample” diversity.</p>
<p>For this part we’re going to swap to another dataset. So you get a little bit more practice examining a phyloseq object. Look at the rank names, sample data variables etc.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao19</span> <span class="co"># this object has another part!</span></span></code></pre></div>
<pre><code><span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 819 taxa and 1644 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 1644 samples by 11 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 819 taxa by 6 taxonomic ranks ]</span></span>
<span><span class="co">## phy_tree()    Phylogenetic Tree: [ 819 tips and 818 internal nodes ]</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span></code></pre></div>
<hr>
<div class="section level4">
<h4 id="filtering">Filtering<a class="anchor" aria-label="anchor" href="#filtering"></a>
</h4>
<p>First, we need to talk about filtering.</p>
<div class="section level5">
<h5 id="sample-filtering">Sample filtering<a class="anchor" aria-label="anchor" href="#sample-filtering"></a>
</h5>
<p>You should check if any of your samples have a surprisingly low total number of (classified) reads. This can suggest that something went wrong in the lab (or during sample collection) and the data from this sample might be unreliable.</p>
<p>You might already do this check for total reads and remove poor quality samples during the fastq file processing.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao19</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_mutate.html">ps_mutate</a></span><span class="op">(</span>reads <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/sample_sums.html" class="external-link">sample_sums</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">reads</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_freqpoly</a></span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Number of classified reads'</span>, y <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-39-1.png" width="720"></p>
<p>How many is enough? There is no easy answer.</p>
<p>These samples have great depth. There are a few with much less reads than the rest, and a few with under a million. You might consider dropping the samples with under a million reads, to see if it affects your results, but in this case we won’t.</p>
<p>But 100,000 is still a lot, compared to what older sequencing machines produced: 1000 reads might have been considered very good. So look at the distribution for your data, in case there are obvious outliers, and look at recent papers using a similar sequencing technique for what kind of threshold they used.</p>
<p>There might also be relevant information for the type of sequencer you used on e.g. Illumina website. e.g. for this type of sequencing Illumina suggests you should expect at least a million reads (and this is good for RNA seq analyses). <a href="https://support.illumina.com/bulletins/2017/04/considerations-for-rna-seq-read-length-and-coverage-.html" class="external-link uri">https://support.illumina.com/bulletins/2017/04/considerations-for-rna-seq-read-length-and-coverage-.html</a></p>
<p>If you are interested, go back and recreate this plot with the 16S sequencing dataset <code>mice</code>.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mice %&gt;%</span></span>
<span><span class="co">#   ps_mutate(reads = sample_sums(mice)) %&gt;%</span></span>
<span><span class="co">#   samdat_tbl() %&gt;%</span></span>
<span><span class="co">#   ggplot(aes(x = reads)) +</span></span>
<span><span class="co">#   geom_freqpoly(bins = 30) +</span></span>
<span><span class="co">#   ... </span></span></code></pre></div>
</div>
<div class="section level5">
<h5 id="taxon-filtering">Taxon filtering<a class="anchor" aria-label="anchor" href="#taxon-filtering"></a>
</h5>
<p>Okay, so we might remove “bad” samples, but how can a taxon be “bad”?</p>
<p>We probably want to filter out <strong>rare</strong> taxa, before performing some kinds of analysis.</p>
<div class="section level6">
<h6 id="why-remove-rare-taxa">Why remove rare taxa?<a class="anchor" aria-label="anchor" href="#why-remove-rare-taxa"></a>
</h6>
<p><strong>Rare taxa might sometimes be:</strong></p>
<ol style="list-style-type: decimal">
<li>Sequencing errors</li>
<li>Statistically problematic</li>
<li>Biologically irrelevant</li>
</ol>
</div>
<div class="section level6">
<h6 id="how-to-remove-rare-taxa">How to remove rare taxa?<a class="anchor" aria-label="anchor" href="#how-to-remove-rare-taxa"></a>
</h6>
<p><strong>What is rare?</strong> Two main concepts.</p>
<ul>
<li>Low <strong>prevalence</strong> - taxon only detected in a small number of samples in your dataset.</li>
<li>Low <strong>abundance</strong> - relatively few reads assigned to that taxon (on average or in total)</li>
</ul>
<p>Consider the impact of issues 1, 2, and 3. Let’s say we are not interested in unique taxa that occur in fewer than 2% of samples, and they have to have at least 10,000 reads in total across all samples.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># before filtering</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/ntaxa-methods.html" class="external-link">ntaxa</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 819</span></span></code></pre>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># after filtering</span></span>
<span><span class="va">shao19</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">100</span>, min_total_abundance <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/ntaxa-methods.html" class="external-link">ntaxa</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Proportional min_prevalence given: 0.02 --&gt; min 33/1644 samples.</span></span></code></pre>
<pre><code><span><span class="co">## [1] 253</span></span></code></pre>
<p>Wow so that would remove <strong>most</strong> of our unique taxa! What is going on? Let’s make some plots!</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make table of summary statistics for the unique taxa in shao19</span></span>
<span><span class="va">shaoTaxaStats</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  taxon <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/taxa_names-methods.html" class="external-link">taxa_names</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span>,</span>
<span>  prevalence <span class="op">=</span> <span class="fu">microbiome</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/microbiome/man/prevalence.html" class="external-link">prevalence</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span>,</span>
<span>  total_abundance <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/taxa_sums.html" class="external-link">taxa_sums</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">shaoTaxaStats</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">total_abundance</span>, <span class="va">prevalence</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Total Abundance"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Prevalence (%)"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span></span>
<span>      trans <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/nsamples-methods.html" class="external-link">nsamples</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_pretty.html" class="external-link">breaks_pretty</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Prevalence (N samples)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-43-1.png" width="720"></p>
<p>So most taxa have a low prevalence, and handful have way more reads than most.</p>
<p>Let’s label those points to check which taxa are the big time players.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu">ggrepel</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html" class="external-link">geom_text_repel</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">df</span><span class="op">)</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">total_abundance</span> <span class="op">&gt;</span> <span class="fl">1e9</span> <span class="op">|</span> <span class="va">prevalence</span> <span class="op">&gt;</span> <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>  mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="va">taxon</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">2.5</span>, min.segment.length <span class="op">=</span> <span class="fl">0</span>, force <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-44-1.png" width="720"></p>
<p>Those taxa make sense for this dataset of mostly infant gut microbiome samples.</p>
<p>Now let’s zoom in on the less abundant taxa by log-transforming the axes. We’ll also add lines indicating the thresholds of 2% prevalence and 10000 reads abundance.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shaoTaxaStats</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_abundance</span>, y <span class="op">=</span> <span class="va">prevalence</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">10000</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Total Abundance"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_log.html" class="external-link">breaks_log</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Prevalence (%)"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span></span>
<span>      trans <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/nsamples-methods.html" class="external-link">nsamples</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_log.html" class="external-link">breaks_log</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Prevalence (N samples)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-45-1.png" width="720"></p>
<p>We can break this down by phylum if we add the taxonomic table information.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># don't worry about this code if it's confusing, just focus on the plot output</span></span>
<span><span class="va">shao19</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/tax_table-methods.html" class="external-link">tax_table</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span>rownames <span class="op">=</span> <span class="st">"taxon"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">shaoTaxaStats</span>, by <span class="op">=</span> <span class="st">"taxon"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">add_count</a></span><span class="op">(</span><span class="va">phylum</span>, name <span class="op">=</span> <span class="st">"phylum_count"</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phylum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">phylum</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">phylum</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="co"># to fix facet order</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phylum <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_lump.html" class="external-link">fct_lump_n</a></span><span class="op">(</span><span class="va">phylum</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>phylum <span class="op">=</span> <span class="fu">forcats</span><span class="fu">::</span><span class="fu"><a href="https://forcats.tidyverse.org/reference/fct_explicit_na.html" class="external-link">fct_explicit_na</a></span><span class="op">(</span><span class="va">phylum</span>, na_level <span class="op">=</span> <span class="st">"Other"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">total_abundance</span>, <span class="va">prevalence</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">10000</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fl">2</span> <span class="op">/</span> <span class="fl">100</span>, color <span class="op">=</span> <span class="st">"red"</span>, linetype <span class="op">=</span> <span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_log10</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_log.html" class="external-link">label_log</a></span><span class="op">(</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_log.html" class="external-link">breaks_log</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Total Abundance"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_log10</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_log.html" class="external-link">breaks_log</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Prevalence (%)"</span>,</span>
<span>    sec.axis <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/sec_axis.html" class="external-link">sec_axis</a></span><span class="op">(</span></span>
<span>      trans <span class="op">=</span> <span class="op">~</span> <span class="va">.</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/pkg/phyloseq/man/nsamples-methods.html" class="external-link">nsamples</a></span><span class="op">(</span><span class="va">shao19</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/breaks_log.html" class="external-link">breaks_log</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>      name <span class="op">=</span> <span class="st">"Prevalence (N samples)"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="st">"phylum"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-46-1.png" width="960"></p>
<p><strong>How to pick a threshold?</strong></p>
<p>Depends on what analysis method you are filtering for!</p>
<ul>
<li>alpha diversity = DO NOT FILTER</li>
<li>beta diversity = relevance of threshold depends on your distance measure (next topic!)</li>
<li>differential abundance testing = stringent filtering, prevalence &gt;5%, &gt;10%? (last topic!)</li>
</ul>
<hr>
</div>
</div>
</div>
<div class="section level4">
<h4 id="dissimilarity-measures">Dissimilarity measures<a class="anchor" aria-label="anchor" href="#dissimilarity-measures"></a>
</h4>
<p>What are we doing? Calculating the dissimilarity of two samples’ compositions. We talked about these dissimilarity measures in the lecture.</p>
<ul>
<li>Binary Jaccard - presence-absence only</li>
<li>Bray-Curtis - abundance weighted</li>
<li>UniFrac distances (unweighted, weighted, generalised)</li>
</ul>
<p>To simplify and speed up the analyses, we’re going to take a smaller part of the dataset. We’ll only look at the 300 infant fecal samples from 4 days of age.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op">&lt;-</span> <span class="va">shao19</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">family_role</span> <span class="op">==</span> <span class="st">"child"</span>, <span class="va">infant_age</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>We’re going to filter out rare taxa quite strictly, for similar reasons. But we won’t overwrite our smaller dataset: we’ll do the filtering per analysis.</p>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"binary"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="co"># converts counts to absence/presence: 0/1</span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"jaccard"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Proportional min_prevalence given: 0.025 --&gt; min 8/306 samples.</span></span></code></pre>
<pre><code><span><span class="co">## ps_extra object - a list with phyloseq and extras:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 35 taxa and 306 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 306 samples by 11 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 35 taxa by 5 taxonomic ranks ]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ps_extra info:</span></span>
<span><span class="co">## tax_agg = genus tax_transform = binary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## jaccard distance matrix of size 306 </span></span>
<span><span class="co">## 0.6666667 0.7333333 0.9375 0.8125 0.6428571 ...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts OTU Table: [ 35 taxa and 306 samples ]</span></span></code></pre>
<p>So we get our pairwise dissimilarities, in a distance matrix attached as an extra part on the original phyloseq object, as part of a container object (a “ps_extra” class object created by microViz, which also stores info about the aggregation and transformations you performed)</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distances</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"binary"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"jaccard"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">dist_get</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You can extract the dissimilarities or distances with dist_get.</p>
<div class="sourceCode" id="cb76"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##             B01089_ba_4 B01190_ba_4 B01194_ba_4 B01196_ba_4 B01235_ba_4</span></span>
<span><span class="co">## B01089_ba_4   0.0000000   0.6666667   0.7333333   0.9375000   0.8125000</span></span>
<span><span class="co">## B01190_ba_4   0.6666667   0.0000000   0.7500000   0.9166667   0.8461538</span></span>
<span><span class="co">## B01194_ba_4   0.7333333   0.7500000   0.0000000   0.4615385   0.3076923</span></span>
<span><span class="co">## B01196_ba_4   0.9375000   0.9166667   0.4615385   0.0000000   0.4615385</span></span>
<span><span class="co">## B01235_ba_4   0.8125000   0.8461538   0.3076923   0.4615385   0.0000000</span></span></code></pre>
<p>The Binary Jaccard dissimilarities range between zero (identical) and one (no shared genera).</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">distances</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0 1</span></span></code></pre>
<hr>
</div>
<div class="section level4">
<h4 id="ordination">Ordination<a class="anchor" aria-label="anchor" href="#ordination"></a>
</h4>
<p>What can we do with these distances or dissimilarities? We can make an ordination.</p>
<p>Ordination refers to the process of ordering things (in our case: samples), so that similar things (samples) are closer to each other, and dissimilar things (samples) are further away.</p>
<div class="section level5">
<h5 id="pcoa">PCoA<a class="anchor" aria-label="anchor" href="#pcoa"></a>
</h5>
<p>Principal Co-ordinates Analysis is one kind of ordination.</p>
<p>Takes distance matrix and finds new dimensions (a co-ordinate system if you like). The new dimensions are created with the aim to preserve the original distances between samples, but to capture the majority of this distance information in the first few dimensions. We like this because it makes it easier to visualize the patterns in your data (in 2D or 3D).</p>
<p>There is helpful info about ordination methods including PCoA on the GUide to STatistical Analysis in Microbial Ecology (GUSTA ME) website. <a href="https://sites.google.com/site/mb3gustame/dissimilarity-based-methods/principal-coordinates-analysis" class="external-link uri">https://sites.google.com/site/mb3gustame/dissimilarity-based-methods/principal-coordinates-analysis</a> This website covers a lot of topics, we’ll cover PCoA now, and PCA in the next session. The other topics may be interesting for you to read at a later date if you’ll work on microbiome analysis.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-52-1.png" width="720"></p>
<p>To get a little insight into what has happened here, we can colour each sample according to its dominant (most abundant) genus.</p>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_calc_dominant.html">ps_calc_dominant</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, none <span class="op">=</span> <span class="st">"Mixed"</span>, other <span class="op">=</span> <span class="st">"Other"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"dominant_genus"</span>, alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Dominant Genus"</span>, palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-53-1.png" width="720"></p>
</div>
<div class="section level5">
<h5 id="interactive-ordination">Interactive ordination!<a class="anchor" aria-label="anchor" href="#interactive-ordination"></a>
</h5>
<p><code>microViz</code> provides a Shiny app <code>ord_explore</code> to interactively create and explore PCoA plots and other ordinations. See the code below to get started. But read the instructions first.</p>
<p><strong>Here are a few things to try:</strong></p>
<ul>
<li>Colour the samples using the variables in the sample data</li>
<li>Select a few samples to view their composition on barplots!</li>
<li>Change some ordination options:
<ul>
<li>Different rank of taxonomic aggregation</li>
<li>Different distances we’ve discussed</li>
</ul>
</li>
<li>Copy the automatically generated code
<ul>
<li>Exit the app (press escape or click red button in R console!)</li>
<li>Paste and run the code to recreate the ordination plot</li>
<li>Customise the plot: change colour scheme, title, etc.</li>
</ul>
</li>
<li>Launch the app again with a different subset of the data
<ul>
<li>Practice using <code>ps_filter</code> etc.</li>
<li>e.g. plot the data of the mothers’ gut microbiomes!</li>
<li>compute one or more alpha diversity measures</li>
</ul>
</li>
</ul>
<p><strong>Beware:</strong></p>
<ul>
<li>UniFrac distances can be quite slow (over a minute) to calculate!
<ul>
<li>Filter to fewer samples and fewer taxa to speed it up (Before launching the app)</li>
</ul>
</li>
<li>There are many distances available, feel free to try out ones we haven’t talked about
<ul>
<li>BUT:
<ul>
<li>You shouldn’t use a distance that you don’t understand in your actual work, even if the plot looks nice! ;)</li>
<li>Some of them might not work…
<ul>
<li>They are mostly implemented in the package <code>vegan</code> and I haven’t tested them all</li>
<li>Errors will appear in the RStudio R console</li>
<li>You can report to me any distances that don’t work if you’re feeling helpful!</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>There are other ordination methods available in <code>ord_explore</code>, which we haven’t discussed
<ul>
<li>We will discuss PCA and various transformations after dinner!</li>
<li>Some things we won’t have time to cover, but you can look here for info on topics like constrained ordination –&gt; TODO: insert gusta me ecology website link</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fire up the shiny app</span></span>
<span><span class="co"># run these lines in your console (don't keep in script/notebook)</span></span>
<span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># calculate new sample variables with dominant taxon (optional)</span></span>
<span>  <span class="fu"><a href="../../reference/ps_calc_dominant.html">ps_calc_dominant</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, none <span class="op">=</span> <span class="st">"Mixed"</span>, other <span class="op">=</span> <span class="st">"Other"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># launch a Shiny app in your web browser!</span></span>
<span>  <span class="fu"><a href="../../reference/ord_explore.html">ord_explore</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># different options</span></span>
<span><span class="co"># run this line in your console</span></span>
<span><span class="va">shao19</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_filter.html">ps_filter</a></span><span class="op">(</span><span class="va">family_role</span> <span class="op">==</span> <span class="st">"mother"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># calculate a few sample variables for interest (optional)</span></span>
<span>  <span class="fu"><a href="../../reference/ps_calc_dominant.html">ps_calc_dominant</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, none <span class="op">=</span> <span class="st">"Mixed"</span>, other <span class="op">=</span> <span class="st">"Other"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_calc_diversity.html">ps_calc_diversity</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, index <span class="op">=</span> <span class="st">"shannon"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_calc_richness.html">ps_calc_richness</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, index <span class="op">=</span> <span class="st">"observed"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># launch a Shiny app in your web browser!</span></span>
<span>  <span class="fu"><a href="../../reference/ord_explore.html">ord_explore</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level4">
<h4 id="permanova">PERMANOVA<a class="anchor" aria-label="anchor" href="#permanova"></a>
</h4>
<p>Permutational multivariate analysis of variance.</p>
<ul>
<li>ANOVA - analysis of variance (statistical modelling approach)</li>
<li>Multivariate - more than one dependent variable (multiple taxa!)</li>
<li>Permutational - statistical significance estimates obtained by shuffling the data many times</li>
</ul>
<p>For more details. See this excellent book chapter by Marti Anderson on PERMANOVA: <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/9781118445112.stat07841" class="external-link uri">https://onlinelibrary.wiley.com/doi/full/10.1002/9781118445112.stat07841</a></p>
<p>Sometimes also called NP-MANOVA (non-parametric MANOVA) e.g. on the GUide to STatistical Analysis in Microbial Ecology <a href="https://sites.google.com/site/mb3gustame/hypothesis-tests/manova/npmanova" class="external-link">website.</a></p>
<p><strong>TLDR:</strong> Are those groups on the PCoA actually different??</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"birth_mode"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/stat_ellipse.html" class="external-link">stat_ellipse</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>color <span class="op">=</span> <span class="va">birth_mode</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_color_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Set1"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-54-1.png" width="720"></p>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_permanova.html">dist_permanova</a></span><span class="op">(</span>variables <span class="op">=</span> <span class="st">"birth_mode"</span>, n_perms <span class="op">=</span> <span class="fl">99</span>, seed <span class="op">=</span> <span class="fl">123</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">perm_get</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 2022-06-27 19:29:05 - Starting PERMANOVA with 99 perms with 1 processes</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:05 - Finished PERMANOVA</span></span></code></pre>
<pre><code><span><span class="co">## Permutation test for adonis under NA model</span></span>
<span><span class="co">## Marginal effects of terms</span></span>
<span><span class="co">## Permutation: free</span></span>
<span><span class="co">## Number of permutations: 99</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## vegan::adonis2(formula = formula, data = metadata, permutations = n_perms, by = by, parallel = parall)</span></span>
<span><span class="co">##             Df SumOfSqs      R2      F Pr(&gt;F)   </span></span>
<span><span class="co">## birth_mode   1   13.790 0.12366 42.898   0.01 **</span></span>
<span><span class="co">## Residual   304   97.727 0.87634                 </span></span>
<span><span class="co">## Total      305  111.518 1.00000                 </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<div class="sourceCode" id="cb89"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use more permutations for a more reliable p.value in your real work (slower)</span></span>
<span><span class="co"># Set a random seed number for reproducibility of this stochastic method</span></span></code></pre></div>
<p>You can see from the model output that the p value, Pr(&gt;F) is below 0.05. So there is good statistical evidence that the bacterial gut microbiota composition of c-section delivered infants has a different composition than vaginally delivered infants at 4 days of age.</p>
<p>You should also report that you used Bray-Curtis dissimilarities, calculated on genera. (after keeping only unique taxa with a prevalence of at least 2.5%!)</p>
<p>It’s probably a good idea to decide on a couple of appropriate distance measures up front for these tests, and report both (at least in supplementary material), as the choice of distance measure can affect results and conclusions!</p>
<p>You can also adjust for covariates in PERMANOVA, and often should, depending on your study design. Let’s fit a more complex model, adjusting for infant sex, birth weight, and the total number of assigned reads.</p>
<div class="sourceCode" id="cb90"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"bray"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_permanova.html">dist_permanova</a></span><span class="op">(</span></span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"birth_mode"</span>, <span class="st">"sex"</span>, <span class="st">"birth_weight"</span>, <span class="st">"number_reads"</span><span class="op">)</span>,</span>
<span>    n_perms <span class="op">=</span> <span class="fl">99</span>, seed <span class="op">=</span> <span class="fl">111</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">perm_get</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Dropping samples with missings: 15</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:06 - Starting PERMANOVA with 99 perms with 1 processes</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:07 - Finished PERMANOVA</span></span></code></pre>
<pre><code><span><span class="co">## Permutation test for adonis under reduced model</span></span>
<span><span class="co">## Marginal effects of terms</span></span>
<span><span class="co">## Permutation: free</span></span>
<span><span class="co">## Number of permutations: 99</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## vegan::adonis2(formula = formula, data = metadata, permutations = n_perms, by = by, parallel = parall)</span></span>
<span><span class="co">##               Df SumOfSqs      R2       F Pr(&gt;F)   </span></span>
<span><span class="co">## birth_mode     1   10.794 0.10163 34.8045   0.01 **</span></span>
<span><span class="co">## sex            1    0.280 0.00264  0.9031   0.43   </span></span>
<span><span class="co">## birth_weight   1    0.565 0.00532  1.8215   0.06 . </span></span>
<span><span class="co">## number_reads   1    2.873 0.02705  9.2656   0.01 **</span></span>
<span><span class="co">## Residual     286   88.696 0.83509                  </span></span>
<span><span class="co">## Total        290  106.211 1.00000                  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use more permutations for a more reliable p.value in your real work (slower)</span></span>
<span><span class="co"># Set a random seed number for reproducibility of this stochastic method</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="transformations-pca-da">3: Transformations, PCA &amp; DA<a class="anchor" aria-label="anchor" href="#transformations-pca-da"></a>
</h2>
<p>This section will introduce you to: the Euclidean distance; log and CLR transformations; heatmaps for microbiome abundance data; Principal Components Analysis (PCA); and Differential Abundance (DA) testing methods.</p>
<hr>
<div class="section level3">
<h3 id="euclidean-distances">Euclidean distances<a class="anchor" aria-label="anchor" href="#euclidean-distances"></a>
</h3>
<p>What about Euclidean distances? What are those?</p>
<p>Euclidean distances are essentially a generalization of Pythagoras’ theorem to more dimensions. In our data every taxon is a feature, a dimension, on which we calculate Euclidean distances.</p>
<ul>
<li><p>Pythagoras: <span class="math inline">\(c = \sqrt{a^2 + b^2}\)</span></p></li>
<li><p>Euclidean distance:</p></li>
</ul>
<p><span class="math display">\[d\left(p, q\right) = \sqrt{\sum _{i=1}^{n_{taxa}} \left( p_{i}-q_{i}\right)^2 }\]</span></p>
<p><strong>Issues</strong></p>
<ul>
<li>Sensitive to sparsity (double-zero problem) –&gt; filter rare taxa</li>
<li>Excessive emphasis on high-abundance taxa –&gt; transform features first</li>
<li>The PCoA looks weird! most samples bunched in the middle with spindly projections..</li>
</ul>
<div class="sourceCode" id="cb96"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_rug.html" class="external-link">geom_rug</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-57-1.png" width="720"></p>
<hr>
</div>
<div class="section level3">
<h3 id="abundance-transformation">Abundance transformation<a class="anchor" aria-label="anchor" href="#abundance-transformation"></a>
</h3>
<p>We already did two transformations with <code><a href="../../reference/tax_transform.html">tax_transform()</a></code>: binary (for Binary Jaccard distances) and compositional (for barplots).</p>
<p>Now we need log transformations, and the centered-log-ratio, CLR, transformation.</p>
<div class="section level4">
<h4 id="log-transformations">Log transformations<a class="anchor" aria-label="anchor" href="#log-transformations"></a>
</h4>
<p>First let’s look at the abundance again, this time with heatmaps.</p>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Getting the taxa in abundance order up front</span></span>
<span><span class="co"># to keep it consistent across multiple plots</span></span>
<span><span class="va">shao4_sorted</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/tax_sort.html">tax_sort</a></span><span class="op">(</span>by <span class="op">=</span> <span class="va">sum</span>, at <span class="op">=</span> <span class="st">"genus"</span>, trans <span class="op">=</span> <span class="st">"compositional"</span>, tree_warn <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Each column is a sample (from an infant), and each row is a taxon.</p>
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4_sorted</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"identity"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_heatmap.html">comp_heatmap</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, grid_lwd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"Counts"</span>,</span>
<span>    tax_seriation <span class="op">=</span> <span class="st">"Identity"</span>, sample_seriation <span class="op">=</span> <span class="st">"Identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-59-1.png" width="720"></p>
<div class="sourceCode" id="cb99"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4_sorted</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"compositional"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_heatmap.html">comp_heatmap</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, grid_lwd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"Prop."</span>,</span>
<span>    tax_seriation <span class="op">=</span> <span class="st">"Identity"</span>, sample_seriation <span class="op">=</span> <span class="st">"Identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-60-1.png" width="720"></p>
<p>We can add the proportions on this small subset of data as numbers.</p>
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4_sorted</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"compositional"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_heatmap.html">comp_heatmap</a></span><span class="op">(</span></span>
<span>    numbers <span class="op">=</span> <span class="fu"><a href="../../reference/heat_numbers.html">heat_numbers</a></span><span class="op">(</span>fmt <span class="op">=</span> <span class="st">"%.1f"</span><span class="op">)</span>, numbers_use_counts <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    samples <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, grid_lwd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"Prop."</span>,</span>
<span>    tax_seriation <span class="op">=</span> <span class="st">"Identity"</span>, sample_seriation <span class="op">=</span> <span class="st">"Identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-61-1.png" width="720"></p>
<p>Even though we have picked the top 20 most abundant genera, there are still a lot of zeros, We need to deal with the zeros, because <code>log(0)</code> is undefined. The solution is to add a small amount to every value (or just every zero), before applying the log transformation. This small value is often called a pseudo-count.</p>
<p>What value should we use for the pseudo-count?</p>
<p>One option is to just add 1, and another popular option is to add half of the smallest observed real value (from across the whole dataset).</p>
<div class="sourceCode" id="cb101"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4_sorted</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, trans <span class="op">=</span> <span class="st">"log10"</span>, zero_replace <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_heatmap.html">comp_heatmap</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, grid_lwd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"log10\n(x+1)"</span>,</span>
<span>    tax_seriation <span class="op">=</span> <span class="st">"Identity"</span>, sample_seriation <span class="op">=</span> <span class="st">"Identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-62-1.png" width="720"></p>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4_sorted</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># tax_transform(trans = 'compositional') %&gt;% # compositional also possible</span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log10"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span>, chain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_heatmap.html">comp_heatmap</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, grid_lwd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"log10\nhalfmin"</span>,</span>
<span>    tax_seriation <span class="op">=</span> <span class="st">"Identity"</span>, sample_seriation <span class="op">=</span> <span class="st">"Identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-63-1.png" width="720"></p>
<p>In general, for zero replacement, keep it simple and <strong>record your approach</strong>.</p>
</div>
<div class="section level4">
<h4 id="centered-log-ratio-transformation">Centered Log Ratio transformation:<a class="anchor" aria-label="anchor" href="#centered-log-ratio-transformation"></a>
</h4>
<p>Compositionality problem is improved by the centered-log-ratio transformation.</p>
<p>The centered log-ratio (clr) transformation uses the geometric mean of the sample vector as the reference.</p>
<div class="sourceCode" id="cb103"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4_sorted</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_agg.html">tax_agg</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># tax_transform(trans = 'compositional') %&gt;% # compositional also possible</span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span>, chain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_heatmap.html">comp_heatmap</a></span><span class="op">(</span></span>
<span>    samples <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">20</span>, grid_lwd <span class="op">=</span> <span class="fl">2</span>, name <span class="op">=</span> <span class="st">"CLR\nhalfmin"</span>,</span>
<span>    colors <span class="op">=</span> <span class="fu"><a href="../../reference/heat_palette.html">heat_palette</a></span><span class="op">(</span>sym <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    tax_seriation <span class="op">=</span> <span class="st">"Identity"</span>, sample_seriation <span class="op">=</span> <span class="st">"Identity"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-64-1.png" width="720"></p>
<details><summary><strong>Overview of CoDa problem.</strong>
</summary><p>The sequencing data gives us relative abundances, not absolute abundances. The total number of reads sequenced per sample is an arbitrary total.</p>
<p>If one taxon blooms, whilst everything else stays stable, the relative abundance of all other taxa must (appear to) go down.</p>
<p>This leads to two main types of problem:</p>
<ul>
<li>interpretation caveats: see differential abundance section later</li>
<li>statistical issues: taxon abundances are not independent, but (weakly?) negatively correlated</li>
</ul>
<p>This is worse with simpler ecosystems. There is the same problem in theory with RNAseq data, but I suspect it is less bothersome because there are many more competing “species” of RNA transcript than there are bacterial species in even a very complex microbiome.</p>
<p>The centered-log-ratio transformation (along with some other similar ratio transformations) are claimed to help with the statistical issues by transforming the abundances from the simplex to the real space.</p>
<p>Practically, the CLR transformation involves finding the geometric mean of each sample, and then dividing abundance of each taxon in that sample by this geometric mean. Finally you take the natural log of this ratio.</p>
<p>For more details, check out Gloor 2017. <a href="https://doi.org/10.3389/fmicb.2017.02224" class="external-link">Microbiome Datasets are Compositional: and this is not optional</a></p>
</details><hr>
</div>
</div>
<div class="section level3">
<h3 id="fun-with-heatmaps">Fun with Heatmaps<a class="anchor" aria-label="anchor" href="#fun-with-heatmaps"></a>
</h3>
<p>Heatmaps look much better when you sort the rows by similarity (using distances and hierarchical clustering!).</p>
<p>More examples/tutorial of visualizing microbiome data using heatmaps can be found here:</p>
<p><a href="https://david-barnett.github.io/microViz/articles/web-only/heatmaps.html" class="uri">https://david-barnett.github.io/microViz/articles/web-only/heatmaps.html</a></p>
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="pca">PCA<a class="anchor" aria-label="anchor" href="#pca"></a>
</h3>
<p>Principal Components Analysis.</p>
<p>Quite similar to Principal Co-ordinates Analysis.</p>
<p>In fact, PCA produces equivalent results to PCoA with euclidean distances. So let’s perform the CLR-transform first and check PCA and euclidean PCoA are the same.</p>
<div class="sourceCode" id="cb105"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, trans <span class="op">=</span> <span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/dist_calc.html">dist_calc</a></span><span class="op">(</span>dist <span class="op">=</span> <span class="st">"euclidean"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCoA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"birth_mode"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_reverse</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-66-1.png" width="720"></p>
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, trans <span class="op">=</span> <span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"birth_mode"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-67-1.png" width="720"></p>
<p>So why is PCA interesting for us? Because the Principal components are built directly from a (linear) combination of the original features.</p>
<p>That means we know how much each taxon contributes to each PC axis, and we can plot this information (loadings) as arrows, alongside the sample points.</p>
<div class="sourceCode" id="cb107"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pca</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, trans <span class="op">=</span> <span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot.html">ord_plot</a></span><span class="op">(</span></span>
<span>    alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">2</span>, color <span class="op">=</span> <span class="st">"birth_mode"</span>,</span>
<span>    plot_taxa <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, tax_vec_length <span class="op">=</span> <span class="fl">0.275</span>,</span>
<span>    tax_lab_style <span class="op">=</span> <span class="fu"><a href="../../reference/Ordination-labels.html">tax_lab_style</a></span><span class="op">(</span></span>
<span>      type <span class="op">=</span> <span class="st">"text"</span>, max_angle <span class="op">=</span> <span class="fl">90</span>, aspect_ratio <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>      size <span class="op">=</span> <span class="fl">3</span>, fontface <span class="op">=</span> <span class="st">"bold"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span><span class="fl">0.7</span>, clip <span class="op">=</span> <span class="st">"off"</span><span class="op">)</span></span>
<span><span class="va">pca</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-68-1.png" width="720"></p>
<p>How to interpret the taxa loading vectors? Cautiously.</p>
<p>There are caveats and nuance to the interpretation of these plots, which are called PCA bi-plots, and you can read more about here: <a href="https://sites.google.com/site/mb3gustame/indirect-gradient-analysis/pca" class="external-link uri">https://sites.google.com/site/mb3gustame/indirect-gradient-analysis/pca</a></p>
<p>The relative length and direction of an arrow indicates how much that taxon contributes to the variation on each visible PC axis, e.g. Variation in Enterococcus contributes quite a lot to variation along the PC2 axis.</p>
<p>This allows you to infer that samples positioned at the bottom of the plot will tend to have higher relative abundance of Enterococcus than samples at the top of the plot.</p>
<p>Interestingly, samples on the right of the plot (which tend to be vaginally-delivered infants) seem to have relatively more Bifidobacterium, Bacteroides and Escherichia, whilst the C-section born infants have relatively more Veillonella.</p>
<p><em>(Side note, Phocaeicola were considered part of Bacteroides until this year!)</em></p>
<p>You might have already noticed this pattern, when exploring and making barplots interactively with <code>ord_explore</code> earlier.</p>
<div class="section level4">
<h4 id="iris-plot">Iris plot<a class="anchor" aria-label="anchor" href="#iris-plot"></a>
</h4>
<p>We can make another kind of barplot now, using the PCA information to order our samples in a circular layout.</p>
<div class="sourceCode" id="cb108"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">iris</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">2.5</span> <span class="op">/</span> <span class="fl">100</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>rank <span class="op">=</span> <span class="st">"genus"</span>, trans <span class="op">=</span> <span class="st">"clr"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_calc.html">ord_calc</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"PCA"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ord_plot_iris.html">ord_plot_iris</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"genus"</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, other <span class="op">=</span> <span class="st">"Other"</span>,</span>
<span>    anno_colour <span class="op">=</span> <span class="st">"birth_mode"</span>, </span>
<span>    anno_colour_style <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.6</span>, size <span class="op">=</span> <span class="fl">0.6</span>, show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="va">iris</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-69-1.png" width="720"></p>
<div class="sourceCode" id="cb109"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span><span class="va">pca</span>, <span class="va">iris</span>, nrow <span class="op">=</span> <span class="fl">1</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-70-1.png" width="1200"></p>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="taxon-stats">Taxon stats<a class="anchor" aria-label="anchor" href="#taxon-stats"></a>
</h3>
<p>From the PCA loadings and barplots above, we have some strong suspicions about which taxa have a higher relative abundance in vaginally delivered infants than in c-section delivered infants, and vice versa, but we can also statistically test this. This is often called “differential abundance” (DA) testing, in the style of “differential expression” (DE) testing from the transcriptomics field.</p>
<div class="sourceCode" id="cb110"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/comp_barplot.html">comp_barplot</a></span><span class="op">(</span></span>
<span>    tax_level <span class="op">=</span> <span class="st">"genus"</span>, n_taxa <span class="op">=</span> <span class="fl">12</span>, facet_by <span class="op">=</span> <span class="st">"birth_mode"</span>,</span>
<span>    label <span class="op">=</span> <span class="cn">NULL</span>, bar_outline_colour <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_flip.html" class="external-link">coord_flip</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.ticks.y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-71-1.png" width="720"></p>
<div class="section level4">
<h4 id="model-one-taxon">Model one taxon<a class="anchor" aria-label="anchor" href="#model-one-taxon"></a>
</h4>
<p>We will start by creating a linear regression model for one genus, Bacteroides. We will transform the count data by first making it proportions, and then taking the binary logarithm, log2, after adding a pseudocount.</p>
<div class="sourceCode" id="cb111"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bacteroidesRegression1</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"compositional"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"log2"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span>, chain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_model.html">tax_model</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"lm"</span>, rank <span class="op">=</span> <span class="st">"genus"</span>, taxa <span class="op">=</span> <span class="st">"Bacteroides"</span>, variables <span class="op">=</span> <span class="st">"birth_mode"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Modelling: Bacteroides</span></span></code></pre>
<div class="sourceCode" id="cb113"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># looking at the regression results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bacteroidesRegression1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## Bacteroides ~ birth_mode</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -7.7492 -0.6172 -0.6172  2.6421 18.0804 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                   Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)       -19.3756     0.4863  -39.84   &lt;2e-16 ***</span></span>
<span><span class="co">## birth_modevaginal   7.1320     0.6812   10.47   &lt;2e-16 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 5.957 on 304 degrees of freedom</span></span>
<span><span class="co">## Multiple R-squared:  0.265,  Adjusted R-squared:  0.2626 </span></span>
<span><span class="co">## F-statistic: 109.6 on 1 and 304 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<div class="sourceCode" id="cb115"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint</a></span><span class="op">(</span><span class="va">bacteroidesRegression1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                        2.5 %     97.5 %</span></span>
<span><span class="co">## (Intercept)       -20.332614 -18.418542</span></span>
<span><span class="co">## birth_modevaginal   5.791662   8.472414</span></span></code></pre>
<div class="sourceCode" id="cb117"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">bacteroidesRegression1</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 2 × 7</span></span></span>
<span><span class="co">##   term              estimate std.error statistic   p.value conf.low conf.high</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)         -<span style="color: #BB0000;">19.4</span>      0.486     -<span style="color: #BB0000;">39.8</span> 1.08<span style="color: #949494;">e</span><span style="color: #BB0000;">-122</span>   -<span style="color: #BB0000;">20.3</span>     -<span style="color: #BB0000;">18.4</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> birth_modevaginal     7.13     0.681      10.5 4.13<span style="color: #949494;">e</span><span style="color: #BB0000;">- 22</span>     5.79      8.47</span></span></code></pre>
<details><summary><p><strong>Click here for optional <code>ggplot2</code> extension exercise:</strong></p>
</summary><p>Starting from a dataframe like the one produced by the code below, plot:</p>
<ol style="list-style-type: decimal">
<li>Easy: The percentage prevalence of Bacteroides in each birth_mode group</li>
<li>Medium: The distribution of relative abundance of Bacteroides in each birth_mode group, omitting zeros, on a log2 scale</li>
<li>Hard: Do task 1 or 2 for for several taxa in one plot - (hint: <code>pivot_longer</code>)</li>
</ol>
<div class="sourceCode" id="cb119"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"compositional"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">ps_get</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_otu2samdat.html">ps_otu2samdat</a></span><span class="op">(</span>taxa <span class="op">=</span> <span class="st">"Bacteroides"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_extra-accessors.html">samdat_tbl</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</details><p>We can fit a model with covariates, as we did for PERMANOVA. We are going to convert the categorical variables into indicator (dummy) variables, and scale the continuous covariates to 0 mean and SD 1 (z-scores). You’ll see this will make our subsequent plots easier to interpret later.</p>
<div class="sourceCode" id="cb120"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shao4</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/ps_mutate.html">ps_mutate</a></span><span class="op">(</span></span>
<span>    C_section <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">birth_mode</span> <span class="op">==</span> <span class="st">"c_section"</span>, true <span class="op">=</span> <span class="fl">1</span>, false <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    Female <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"female"</span>, true <span class="op">=</span> <span class="fl">1</span>, false <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>    Birth_weight_Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">birth_weight</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    Reads_Z <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html" class="external-link">scale</a></span><span class="op">(</span><span class="va">number_reads</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb121"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bacteroidesRegression2</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"compositional"</span>, rank <span class="op">=</span> <span class="st">"genus"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"log2"</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span>, chain <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_model.html">tax_model</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="st">"lm"</span>, rank <span class="op">=</span> <span class="st">"genus"</span>, taxa <span class="op">=</span> <span class="st">"Bacteroides"</span>,</span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"C_section"</span>, <span class="st">"Female"</span>, <span class="st">"Birth_weight_Z"</span>, <span class="st">"Reads_Z"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Modelling: Bacteroides</span></span></code></pre>
<div class="sourceCode" id="cb123"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># looking at the regression results</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">bacteroidesRegression2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## Bacteroides ~ C_section + Female + Birth_weight_Z + Reads_Z</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residuals:</span></span>
<span><span class="co">##     Min      1Q  Median      3Q     Max </span></span>
<span><span class="co">## -9.4271 -2.1555 -0.4115  2.8176 18.1784 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">##                Estimate Std. Error t value Pr(&gt;|t|)    </span></span>
<span><span class="co">## (Intercept)    -11.7942     0.6103 -19.325   &lt;2e-16 ***</span></span>
<span><span class="co">## C_section       -7.5696     0.7206 -10.505   &lt;2e-16 ***</span></span>
<span><span class="co">## Female          -0.3809     0.7101  -0.536    0.592    </span></span>
<span><span class="co">## Birth_weight_Z   0.3277     0.3514   0.932    0.352    </span></span>
<span><span class="co">## Reads_Z          0.5361     0.3620   1.481    0.140    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Residual standard error: 5.934 on 286 degrees of freedom</span></span>
<span><span class="co">##   (15 observations deleted due to missingness)</span></span>
<span><span class="co">## Multiple R-squared:  0.2854, Adjusted R-squared:  0.2754 </span></span>
<span><span class="co">## F-statistic: 28.55 on 4 and 286 DF,  p-value: &lt; 2.2e-16</span></span></code></pre>
<div class="sourceCode" id="cb125"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">broom</span><span class="fu">::</span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html" class="external-link">tidy</a></span><span class="op">(</span><span class="va">bacteroidesRegression2</span>, conf.int <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 5 × 7</span></span></span>
<span><span class="co">##   term           estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> (Intercept)     -<span style="color: #BB0000;">11.8</span>       0.610   -<span style="color: #BB0000;">19.3</span>   8.15<span style="color: #949494;">e</span><span style="color: #BB0000;">-54</span>  -<span style="color: #BB0000;">13.0</span>      -<span style="color: #BB0000;">10.6</span> </span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> C_section        -<span style="color: #BB0000;">7.57</span>      0.721   -<span style="color: #BB0000;">10.5</span>   4.81<span style="color: #949494;">e</span><span style="color: #BB0000;">-22</span>   -<span style="color: #BB0000;">8.99</span>      -<span style="color: #BB0000;">6.15</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> Female           -<span style="color: #BB0000;">0.381</span>     0.710    -<span style="color: #BB0000;">0.536</span> 5.92<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>   -<span style="color: #BB0000;">1.78</span>       1.02</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> Birth_weight_Z    0.328     0.351     0.932 3.52<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>   -<span style="color: #BB0000;">0.364</span>      1.02</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> Reads_Z           0.536     0.362     1.48  1.40<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>   -<span style="color: #BB0000;">0.176</span>      1.25</span></span></code></pre>
<div class="section level5">
<h5 id="many-da-methods">Many DA methods<a class="anchor" aria-label="anchor" href="#many-da-methods"></a>
</h5>
<p>This method is what MaAsLin2 does by default (except they call the compositional transformation “Total Sum Scaling (TSS)”). This is quite a straightforward method, so we will stick with this for today, but many statistical methods have been developed for differential abundance analyses.</p>
<p>Microbiome abundance data are quite awkward, statistically speaking, due to their sparseness and compositionality. Each successive method claims to handle some aspect of this awkwardness “better” than previous methods.</p>
<p>The aim is to have a method with adequate power to detect true associations, whilst controlling the type 1 error rate, the “false positive” reporting of associations that are not “truly” present.</p>
<p>Results are surprisingly inconsistent across the different methods, as demonstrated this year in a <a href="https://www.nature.com/articles/s41467-022-28034-z" class="external-link">fascinating analysis by Jacob Nearing and colleagues</a>.</p>
<p><strong>What to do?</strong></p>
<ul>
<li>Filter out the noise &amp; interpret results with caution! use multiple testing corrections</li>
<li>Remember it’s all relative (abundance)</li>
<li>Try multiple methods and/or use same method as previous study if replicating
<ul>
<li>Avoid Lefse and edgeR?</li>
<li>Beware: Not all methods allow covariate adjustment &amp; few allow random effects (for time-series)</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section level4">
<h4 id="model-all-the-taxa">Model all the taxa!<a class="anchor" aria-label="anchor" href="#model-all-the-taxa"></a>
</h4>
<p>We’re not normally interested in just one taxon! And often it’s also hard to decide which taxonomic rank we are most interested in modelling!</p>
<p><em>Lower ranks like species or ASVs give better resolution but also more sparsity and classification uncertainty…</em> <em>Higher ranks e.g. classes, could also be more powerful if you think most taxa within that class will follow a similar pattern.</em></p>
<p>So now we will fit a similar model for almost* every taxon at every rank we have available, from phylum down to species.</p>
<p>*We’ll actually filter out species with a prevalence of less than 10%.</p>
<div class="sourceCode" id="cb127"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The code for `taxatree_models` is quite similar to tax_model. </span></span>
<span><span class="co"># However, you might need to run `tax_prepend_ranks` to ensure that each taxon at each rank is always unique. </span></span>
<span><span class="va">shaoModels</span> <span class="op">&lt;-</span> <span class="va">shao4</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/tax_prepend_ranks.html">tax_prepend_ranks</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span><span class="st">"compositional"</span>, rank <span class="op">=</span> <span class="st">"species"</span>, keep_counts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/tax_filter.html">tax_filter</a></span><span class="op">(</span>min_prevalence <span class="op">=</span> <span class="fl">0.1</span>, undetected <span class="op">=</span> <span class="fl">0</span>, use_counts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/tax_transform.html">tax_transform</a></span><span class="op">(</span>trans <span class="op">=</span> <span class="st">"log2"</span>, chain <span class="op">=</span> <span class="cn">TRUE</span>, zero_replace <span class="op">=</span> <span class="st">"halfmin"</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/taxatree_models.html">taxatree_models</a></span><span class="op">(</span></span>
<span>    type <span class="op">=</span> <span class="va">lm</span>, </span>
<span>    ranks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"phylum"</span>, <span class="st">"class"</span>, <span class="st">"order"</span>, <span class="st">"family"</span>, <span class="st">"genus"</span>, <span class="st">"species"</span><span class="op">)</span>, </span>
<span>    variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'C_section'</span>, <span class="st">'Female'</span>, <span class="st">'Birth_weight_Z'</span>, <span class="st">'Reads_Z'</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Proportional min_prevalence given: 0.1 --&gt; min 31/306 samples.</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:51 - modelling at rank: phylum</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:51 - modelling at rank: class</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:51 - modelling at rank: order</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:52 - modelling at rank: family</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:52 - modelling at rank: genus</span></span></code></pre>
<pre><code><span><span class="co">## 2022-06-27 19:29:53 - modelling at rank: species</span></span></code></pre>
<div class="sourceCode" id="cb135"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shaoModels</span></span></code></pre></div>
<pre><code><span><span class="co">## ps_extra object - a list with phyloseq and extras:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 39 taxa and 306 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 306 samples by 15 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 39 taxa by 6 taxonomic ranks ]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ps_extra info:</span></span>
<span><span class="co">## tax_agg = species tax_transform = compositional&amp;log2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts OTU Table: [ 39 taxa and 306 samples ]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $taxatree_models list:</span></span>
<span><span class="co">## Ranks: phylum/class/order/family/genus/species</span></span></code></pre>
<p><em>Why filter the taxa? It’s less likely that we are interested in rare taxa, and models of rare taxon abundances are more likely to be unreliable. Reducing the the number of taxa modelled also makes the process faster and makes visualizing the results easier!</em></p>
<div class="section level5">
<h5 id="getting-stats-from-the-models">Getting stats from the models<a class="anchor" aria-label="anchor" href="#getting-stats-from-the-models"></a>
</h5>
<p>Next we will get a data.frame containing the regression coefficient estimates, test statistics and corresponding p values from all these regression models.</p>
<div class="sourceCode" id="cb137"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shaoStats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/taxatree_models2stats.html">taxatree_models2stats</a></span><span class="op">(</span><span class="va">shaoModels</span><span class="op">)</span></span>
<span><span class="va">shaoStats</span></span></code></pre></div>
<pre><code><span><span class="co">## ps_extra object - a list with phyloseq and extras:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## phyloseq-class experiment-level object</span></span>
<span><span class="co">## otu_table()   OTU Table:         [ 39 taxa and 306 samples ]</span></span>
<span><span class="co">## sample_data() Sample Data:       [ 306 samples by 15 sample variables ]</span></span>
<span><span class="co">## tax_table()   Taxonomy Table:    [ 39 taxa by 6 taxonomic ranks ]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## ps_extra info:</span></span>
<span><span class="co">## tax_agg = species tax_transform = compositional&amp;log2</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $counts OTU Table: [ 39 taxa and 306 samples ]</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $taxatree_stats dataframe:</span></span>
<span><span class="co">## 86 taxa at 6 ranks: phylum, class, order, family, genus, species </span></span>
<span><span class="co">## 4 terms: C_section, Female, Birth_weight_Z, Reads_Z</span></span></code></pre>
<div class="sourceCode" id="cb139"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shaoStats</span><span class="op">$</span><span class="va">taxatree_stats</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 344 × 7</span></span></span>
<span><span class="co">##    term           taxon             rank   estimate std.error statistic  p.value</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> C_section      p: Proteobacteria phylum  -<span style="color: #BB0000;">3.44</span>       1.31    -<span style="color: #BB0000;">2.62</span>   9.23<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Female         p: Proteobacteria phylum   0.595      1.29     0.460  6.46<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Birth_weight_Z p: Proteobacteria phylum   0.017<span style="text-decoration: underline;">9</span>     0.640    0.027<span style="text-decoration: underline;">9</span> 9.78<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Reads_Z        p: Proteobacteria phylum  -<span style="color: #BB0000;">1.22</span>       0.659   -<span style="color: #BB0000;">1.86</span>   6.44<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> C_section      p: Actinobacteria phylum -<span style="color: #BB0000;">16.9</span>        2.37    -<span style="color: #BB0000;">7.12</span>   8.98<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Female         p: Actinobacteria phylum  -<span style="color: #BB0000;">2.80</span>       2.33    -<span style="color: #BB0000;">1.20</span>   2.30<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Birth_weight_Z p: Actinobacteria phylum   1.65       1.15     1.43   1.55<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Reads_Z        p: Actinobacteria phylum  -<span style="color: #BB0000;">2.86</span>       1.19    -<span style="color: #BB0000;">2.41</span>   1.67<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> C_section      p: Firmicutes     phylum  15.3        4.21     3.62   3.43<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Female         p: Firmicutes     phylum   0.741      4.15     0.179  8.58<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #949494;"># … with 334 more rows</span></span></span></code></pre>
</div>
<div class="section level5">
<h5 id="adjusting-p-values">Adjusting p values<a class="anchor" aria-label="anchor" href="#adjusting-p-values"></a>
</h5>
<p>As we have performed a lot of statistical tests here, it is quite possible that could we find some significant p-values by chance alone.</p>
<p>So we should correct for multiple testing / control the false discovery rate or family-wise error rate.</p>
<p>Instead of applying these adjustment methods across all 86 taxa models at all ranks, the default behaviour is to control the family-wise error rate per taxonomic rank.</p>
<div class="sourceCode" id="cb141"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shaoStats</span> <span class="op">&lt;-</span> <span class="va">shaoStats</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../../reference/taxatree_stats_p_adjust.html">taxatree_stats_p_adjust</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"BH"</span>, grouping <span class="op">=</span> <span class="st">"rank"</span><span class="op">)</span></span>
<span><span class="co"># notice the new variable</span></span>
<span><span class="va">shaoStats</span><span class="op">$</span><span class="va">taxatree_stats</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 344 × 8</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   rank [6]</span></span></span>
<span><span class="co">##    term          taxon rank  estimate std.error statistic  p.value p.adj.BH.rank</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> C_section     p: P… phyl…  -<span style="color: #BB0000;">3.44</span>       1.31    -<span style="color: #BB0000;">2.62</span>   9.23<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span>      2.95<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> Female        p: P… phyl…   0.595      1.29     0.460  6.46<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>      7.38<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> Birth_weight… p: P… phyl…   0.017<span style="text-decoration: underline;">9</span>     0.640    0.027<span style="text-decoration: underline;">9</span> 9.78<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>      9.78<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> Reads_Z       p: P… phyl…  -<span style="color: #BB0000;">1.22</span>       0.659   -<span style="color: #BB0000;">1.86</span>   6.44<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>      1.47<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> C_section     p: A… phyl… -<span style="color: #BB0000;">16.9</span>        2.37    -<span style="color: #BB0000;">7.12</span>   8.98<span style="color: #949494;">e</span><span style="color: #BB0000;">-12</span>      7.19<span style="color: #949494;">e</span><span style="color: #BB0000;">-11</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> Female        p: A… phyl…  -<span style="color: #BB0000;">2.80</span>       2.33    -<span style="color: #BB0000;">1.20</span>   2.30<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>      3.07<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> Birth_weight… p: A… phyl…   1.65       1.15     1.43   1.55<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>      2.48<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> Reads_Z       p: A… phyl…  -<span style="color: #BB0000;">2.86</span>       1.19    -<span style="color: #BB0000;">2.41</span>   1.67<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span>      4.46<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> C_section     p: F… phyl…  15.3        4.21     3.62   3.43<span style="color: #949494;">e</span><span style="color: #BB0000;">- 4</span>      1.83<span style="color: #949494;">e</span><span style="color: #BB0000;">- 3</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> Female        p: F… phyl…   0.741      4.15     0.179  8.58<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span>      9.16<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">## <span style="color: #949494;"># … with 334 more rows</span></span></span></code></pre>
</div>
</div>
<div class="section level4">
<h4 id="plot-all-the-taxatree_stats">Plot all the taxatree_stats!<a class="anchor" aria-label="anchor" href="#plot-all-the-taxatree_stats"></a>
</h4>
<p><code><a href="../../reference/taxatree_plots.html">taxatree_plots()</a></code> allows you to plot statistics (e.g. point estimates and significance) from all of the taxa models onto a tree layout. The taxon models are organised by rank, radiating out from the central root node from e.g. Phyla around the center to Species in the outermost ring.</p>
<p><code><a href="../../reference/taxatree_plots.html">taxatree_plots()</a></code> itself returns a list of plots, which you can arrange into one figure with the <a href="https://patchwork.data-imaginist.com/" class="external-link"><code>patchwork</code></a> package for example (and/or <a href="https://wilkelab.org/cowplot/articles/plot_grid.html" class="external-link"><code>cowplot</code></a>).</p>
<div class="sourceCode" id="cb143"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">shaoStats</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/taxatree_plots.html">taxatree_plots</a></span><span class="op">(</span>node_size_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, sig_stat <span class="op">=</span> <span class="st">'p.adj.BH.rank'</span><span class="op">)</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">patchwork</span><span class="fu">::</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/wrap_plots.html" class="external-link">wrap_plots</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span>, guides <span class="op">=</span> <span class="st">"collect"</span><span class="op">)</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-78-1.png" width="720"></p>
<div class="section level5">
<h5 id="taxatree-key">Taxatree Key<a class="anchor" aria-label="anchor" href="#taxatree-key"></a>
</h5>
<p>But how do we know which taxa are which nodes? We can create a labelled grey tree with <code><a href="../../reference/taxatree_plotkey.html">taxatree_plotkey()</a></code>. This labels only some of the taxa based on certain conditions that we specify.</p>
<div class="sourceCode" id="cb144"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># label position </span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="va">shaoStats</span> <span class="op"><a href="../../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../../reference/taxatree_plotkey.html">taxatree_plotkey</a></span><span class="op">(</span></span>
<span>    taxon_renamer <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html" class="external-link">str_remove</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"[pfg]: "</span><span class="op">)</span>,</span>
<span>    <span class="co"># conditions below, for filtering taxa to be labelled</span></span>
<span>    <span class="va">rank</span> <span class="op">==</span> <span class="st">"phylum"</span> <span class="op">|</span> <span class="va">rank</span> <span class="op">==</span> <span class="st">"genus"</span> <span class="op">&amp;</span> <span class="va">prevalence</span> <span class="op">&gt;</span> <span class="fl">0.2</span></span>
<span>    <span class="co"># all phyla are labelled, and all genera with a prevalence of over 0.2</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="va">key</span></span></code></pre></div>
<p><img src="exercises_files/figure-html/unnamed-chunk-79-1.png" width="540"></p>
<p>You can do more with these trees to customise them to your liking. See an extended tutorial <a href="https://david-barnett.github.io/microViz/articles/web-only/modelling-taxa.html#plot-all-the-taxatree_stats">here on the microViz website</a>: including how to directly label taxa on the colored plots, change the layout and style of the trees, and even how to use a different regression modelling approach.</p>
<div class="sourceCode" id="cb145"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># try it out!</span></span></code></pre></div>
<hr>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="session-info">Session info<a class="anchor" aria-label="anchor" href="#session-info"></a>
</h2>
<p><code>session_info</code> records your package versions etc. This is useful for debugging / reproducing analysis.</p>
<div class="sourceCode" id="cb146"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://r-lib.github.io/sessioninfo/reference/session_info.html" class="external-link">session_info</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BBBB; font-weight: bold;">─ Session info ───────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">##  <span style="color: #555555; font-style: italic;">setting </span> <span style="color: #555555; font-style: italic;">value</span></span></span>
<span><span class="co">##  version  R version 4.2.0 (2022-04-22)</span></span>
<span><span class="co">##  os       Ubuntu 20.04.4 LTS</span></span>
<span><span class="co">##  system   x86_64, linux-gnu</span></span>
<span><span class="co">##  ui       X11</span></span>
<span><span class="co">##  language en</span></span>
<span><span class="co">##  collate  C.UTF-8</span></span>
<span><span class="co">##  ctype    C.UTF-8</span></span>
<span><span class="co">##  tz       UTC</span></span>
<span><span class="co">##  date     2022-06-27</span></span>
<span><span class="co">##  pandoc   2.14.2 @ /usr/bin/ (via rmarkdown)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB; font-weight: bold;">─ Packages ───────────────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">##  <span style="color: #555555; font-style: italic;">package         </span> <span style="color: #555555; font-style: italic;">*</span> <span style="color: #555555; font-style: italic;">version </span> <span style="color: #555555; font-style: italic;">date (UTC)</span> <span style="color: #555555; font-style: italic;">lib</span> <span style="color: #555555; font-style: italic;">source</span></span></span>
<span><span class="co">##  ade4               1.7-19   <span style="color: #555555;">2022-04-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ape                5.6-2    <span style="color: #555555;">2022-03-02</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  backports          1.4.1    <span style="color: #555555;">2021-12-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  Biobase            2.56.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  BiocGenerics       0.42.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  biomformat         1.24.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  Biostrings         2.64.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  bitops             1.0-7    <span style="color: #555555;">2021-04-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  brio               1.1.3    <span style="color: #555555;">2021-11-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  broom              0.8.0    <span style="color: #555555;">2022-04-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  bslib              0.3.1    <span style="color: #555555;">2021-10-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  cachem             1.0.6    <span style="color: #555555;">2021-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  callr              3.7.0    <span style="color: #555555;">2021-04-20</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  circlize           0.4.15   <span style="color: #555555;">2022-05-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  cli                3.3.0    <span style="color: #555555;">2022-04-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  clue               0.3-61   <span style="color: #555555;">2022-05-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  cluster            2.1.3    <span style="color: #555555;">2022-03-28</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  codetools          0.2-18   <span style="color: #555555;">2020-11-04</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  colorspace         2.0-3    <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ComplexHeatmap     2.12.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  corncob            0.2.0    <span style="color: #555555;">2021-03-11</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  crayon             1.5.1    <span style="color: #555555;">2022-03-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  data.table         1.14.2   <span style="color: #555555;">2021-09-27</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  desc               1.4.1    <span style="color: #555555;">2022-03-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  devtools           2.4.3    <span style="color: #555555;">2021-11-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  digest             0.6.29   <span style="color: #555555;">2021-12-01</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  doParallel         1.0.17   <span style="color: #555555;">2022-02-07</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  dplyr            * 1.0.9    <span style="color: #555555;">2022-04-28</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ellipsis           0.3.2    <span style="color: #555555;">2021-04-29</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  evaluate           0.15     <span style="color: #555555;">2022-02-18</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  fansi              1.0.3    <span style="color: #555555;">2022-03-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  farver             2.1.0    <span style="color: #555555;">2021-02-28</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  fastmap            1.1.0    <span style="color: #555555;">2021-01-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  forcats            0.5.1    <span style="color: #555555;">2021-01-27</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  foreach            1.5.2    <span style="color: #555555;">2022-02-02</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  fs                 1.5.2    <span style="color: #555555;">2021-12-08</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  future             1.26.1   <span style="color: #555555;">2022-05-27</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  future.apply       1.9.0    <span style="color: #555555;">2022-04-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  generics           0.1.2    <span style="color: #555555;">2022-01-31</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  GenomeInfoDb       1.32.2   <span style="color: #555555;">2022-05-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  GenomeInfoDbData   1.2.8    <span style="color: #555555;">2022-06-24</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  GetoptLong         1.0.5    <span style="color: #555555;">2020-12-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ggforce            0.3.3    <span style="color: #555555;">2021-03-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ggplot2          * 3.3.6    <span style="color: #555555;">2022-05-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ggraph             2.0.5    <span style="color: #555555;">2021-02-23</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ggrepel            0.9.1    <span style="color: #555555;">2021-01-15</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  GlobalOptions      0.1.2    <span style="color: #555555;">2020-06-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  globals            0.15.1   <span style="color: #555555;">2022-06-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  glue               1.6.2    <span style="color: #555555;">2022-02-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  graphlayouts       0.8.0    <span style="color: #555555;">2022-01-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  gridExtra          2.3      <span style="color: #555555;">2017-09-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  gtable             0.3.0    <span style="color: #555555;">2019-03-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  highr              0.9      <span style="color: #555555;">2021-04-16</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  htmltools          0.5.2    <span style="color: #555555;">2021-08-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  httpuv             1.6.5    <span style="color: #555555;">2022-01-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  igraph             1.3.2    <span style="color: #555555;">2022-06-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  IRanges            2.30.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  iterators          1.0.14   <span style="color: #555555;">2022-02-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  jquerylib          0.1.4    <span style="color: #555555;">2021-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  jsonlite           1.8.0    <span style="color: #555555;">2022-02-22</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  knitr              1.39     <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  labeling           0.4.2    <span style="color: #555555;">2020-10-20</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  later              1.3.0    <span style="color: #555555;">2021-08-18</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  lattice            0.20-45  <span style="color: #555555;">2021-09-22</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  lifecycle          1.0.1    <span style="color: #555555;">2021-09-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  listenv            0.8.0    <span style="color: #555555;">2019-12-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  magrittr           2.0.3    <span style="color: #555555;">2022-03-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  MASS               7.3-56   <span style="color: #555555;">2022-03-23</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  Matrix             1.4-1    <span style="color: #555555;">2022-03-23</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  matrixStats        0.62.0   <span style="color: #555555;">2022-04-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  memoise            2.0.1    <span style="color: #555555;">2021-11-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  mgcv               1.8-40   <span style="color: #555555;">2022-03-29</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  microbiome         1.18.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  microViz         * 0.9.2    <span style="color: #555555;">2022-06-27</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">local</span></span></span>
<span><span class="co">##  mime               0.12     <span style="color: #555555;">2021-09-28</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  multtest           2.52.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  munsell            0.5.0    <span style="color: #555555;">2018-06-12</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  nlme               3.1-157  <span style="color: #555555;">2022-03-25</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  parallelly         1.32.0   <span style="color: #555555;">2022-06-07</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  patchwork          1.1.1    <span style="color: #555555;">2020-12-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  permute            0.9-7    <span style="color: #555555;">2022-01-27</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  phyloseq         * 1.40.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  pillar             1.7.0    <span style="color: #555555;">2022-02-01</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  pkgbuild           1.3.1    <span style="color: #555555;">2021-12-20</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  pkgconfig          2.0.3    <span style="color: #555555;">2019-09-22</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  pkgdown            2.0.5    <span style="color: #555555;">2022-06-23</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">any (@2.0.5)</span></span></span>
<span><span class="co">##  pkgload            1.2.4    <span style="color: #555555;">2021-11-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  plyr               1.8.7    <span style="color: #555555;">2022-03-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  png                0.1-7    <span style="color: #555555;">2013-12-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  polyclip           1.10-0   <span style="color: #555555;">2019-03-14</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  prettyunits        1.1.1    <span style="color: #555555;">2020-01-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  processx           3.6.1    <span style="color: #555555;">2022-06-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  promises           1.2.0.1  <span style="color: #555555;">2021-02-11</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ps                 1.7.1    <span style="color: #555555;">2022-06-18</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  purrr            * 0.3.4    <span style="color: #555555;">2020-04-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  R6                 2.5.1    <span style="color: #555555;">2021-08-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  ragg               1.2.2    <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  RColorBrewer       1.1-3    <span style="color: #555555;">2022-04-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  Rcpp               1.0.8.3  <span style="color: #555555;">2022-03-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  RCurl              1.98-1.7 <span style="color: #555555;">2022-06-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  registry           0.5-1    <span style="color: #555555;">2019-03-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  remotes            2.4.2    <span style="color: #555555;">2021-11-30</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  reshape2           1.4.4    <span style="color: #555555;">2020-04-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  rhdf5              2.40.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  rhdf5filters       1.8.0    <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  Rhdf5lib           1.18.2   <span style="color: #555555;">2022-05-15</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  rjson              0.2.21   <span style="color: #555555;">2022-01-09</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  rlang              1.0.2    <span style="color: #555555;">2022-03-04</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  rmarkdown          2.14     <span style="color: #555555;">2022-04-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  rprojroot          2.0.3    <span style="color: #555555;">2022-04-02</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  Rtsne              0.16     <span style="color: #555555;">2022-04-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  S4Vectors          0.34.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  sass               0.4.1    <span style="color: #555555;">2022-03-23</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  scales             1.2.0    <span style="color: #555555;">2022-04-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  seriation        * 1.3.5    <span style="color: #555555;">2022-03-28</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  sessioninfo        1.2.2    <span style="color: #555555;">2021-12-06</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  shape              1.4.6    <span style="color: #555555;">2021-05-19</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  shiny            * 1.7.1    <span style="color: #555555;">2021-10-02</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  stringi            1.7.6    <span style="color: #555555;">2021-11-29</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  stringr            1.4.0    <span style="color: #555555;">2019-02-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  survival           3.3-1    <span style="color: #555555;">2022-03-03</span> <span style="color: #555555;">[2]</span> <span style="color: #555555;">CRAN (R 4.2.0)</span></span></span>
<span><span class="co">##  systemfonts        1.0.4    <span style="color: #555555;">2022-02-11</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  testthat           3.1.4    <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  textshaping        0.3.6    <span style="color: #555555;">2021-10-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  tibble             3.1.7    <span style="color: #555555;">2022-05-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  tidygraph          1.2.1    <span style="color: #555555;">2022-04-05</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  tidyr              1.2.0    <span style="color: #555555;">2022-02-01</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  tidyselect         1.1.2    <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  TSP                1.2-0    <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  tweenr             1.0.2    <span style="color: #555555;">2021-03-23</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  usethis            2.1.6    <span style="color: #555555;">2022-05-25</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  utf8               1.2.2    <span style="color: #555555;">2021-07-24</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  vctrs              0.4.1    <span style="color: #555555;">2022-04-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  vegan              2.6-2    <span style="color: #555555;">2022-04-17</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  viridis            0.6.2    <span style="color: #555555;">2021-10-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  viridisLite        0.4.0    <span style="color: #555555;">2021-04-13</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  withr              2.5.0    <span style="color: #555555;">2022-03-03</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  xfun               0.31     <span style="color: #555555;">2022-05-10</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  xtable             1.8-4    <span style="color: #555555;">2019-04-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  XVector            0.36.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">##  yaml               2.3.5    <span style="color: #555555;">2022-02-21</span> <span style="color: #555555;">[1]</span> <span style="color: #BB00BB; font-weight: bold;">RSPM</span></span></span>
<span><span class="co">##  zlibbioc           1.42.0   <span style="color: #555555;">2022-04-26</span> <span style="color: #555555;">[1]</span> <span style="color: #555555;">Bioconductor</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #555555;"> [1] /home/runner/work/_temp/Library</span></span></span>
<span><span class="co">## <span style="color: #555555;"> [2] /opt/R/4.2.0/lib/R/library</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB; font-weight: bold;">──────────────────────────────────────────────────────────────────────────────</span></span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by David Barnett.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '22e6f0a75b7b1ffae9bf5bc5b58864d7',
    indexName: 'microViz',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
